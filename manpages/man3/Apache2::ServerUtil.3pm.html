<!DOCTYPE html>

<HTML><head><TITLE>Manpage of docs::api::Apache2::ServerUtil</TITLE>
<meta charset="utf-8">
<link rel="stylesheet" href="/css/main.css" type="text/css">
</head>
<body>
 <header class="site-header">
 <div class="wrap"> <div class="site-title"><a href="/manpages/index.html">linux man pages</a></div>
 <div class="site-description">{"type":"programming"}</div>
 </div>
 </header>
 <div class="page-content">
<H1>docs::api::Apache2::ServerUtil</H1>
Section: User Contributed Perl Documentation (3)<BR>Updated: 2007-11-12<BR><A HREF="#index">Index</A>
<A HREF="/manpages/index.html">Return to Main Contents</A><HR>






<A NAME="lbAB">&nbsp;</A>
<H2>NAME</H2>

Apache2::ServerUtil - Perl API for Apache server record utils
<A NAME="lbAC">&nbsp;</A>
<H2>Synopsis</H2>

<A NAME="ixAAC"></A>


<PRE>
  use Apache2::ServerUtil ();
  $s = Apache2::ServerUtil-&gt;server;
  
  # push config
  $s-&gt;add_config(['ServerTokens off']);
  
  # add components to the Server signature
  $s-&gt;add_version_component(&quot;MyModule/1.234&quot;);
  
  # access PerlSetVar/PerlAddVar values
  my $srv_cfg = $s-&gt;dir_config;
  
  # check command line defines
  print &quot;this is mp2&quot;
      if Apache2::ServerUtil::exists_config_define('MODPERL2');
  
  # get PerlChildExitHandler configured handlers
  @handlers = @{ $s-&gt;get_handlers('PerlChildExitHandler') || []};
  
  # server build and version info:
  $when_built = Apache2::ServerUtil::get_server_built(); 
  $description = Apache2::ServerUtil::get_server_description(); 
  $version = Apache2::ServerUtil::get_server_version();
  $banner = Apache2::ServerUtil::get_server_banner(); 
  
  # ServerRoot value
  $server_root = Apache2::ServerUtil::server_root();
  
  # get 'conf/' dir path (avoid using this function!)
  my $dir = Apache2::ServerUtil::server_root_relative($r-&gt;pool, 'conf');
  
  # set child_exit handlers
  $r-&gt;set_handlers(PerlChildExitHandler =&gt; \&amp;handler);
  
  # server level PerlOptions flags lookup
  $s-&gt;push_handlers(ChildExit =&gt; \&amp;child_exit)
      if $s-&gt;is_perl_option_enabled('ChildExit');
  
  # extend HTTP to support a new method
  $s-&gt;method_register('NEWGET');
  
  # register server shutdown callback
  Apache2::ServerUtil::server_shutdown_register_cleanup(sub { Apache2::Const::OK });
  
  # do something only when the server restarts
  my $cnt = Apache2::ServerUtil::restart_count();
  do_something_once() if $cnt &gt; 1;
  
  # get the resolved ids from Group and User entries
  my $user_id  = Apache2::ServerUtil-&gt;user_id;
  my $group_id = Apache2::ServerUtil-&gt;group_id;

</PRE>


<A NAME="lbAD">&nbsp;</A>
<H2>Description</H2>

<A NAME="ixAAD"></A>
<TT>&quot;Apache2::ServerUtil&quot;</TT> provides the Apache server
object utilities <FONT SIZE="-1">API</FONT>.
<A NAME="lbAE">&nbsp;</A>
<H2>Methods API</H2>

<A NAME="ixAAE"></A>
<TT>&quot;Apache2::ServerUtil&quot;</TT> provides the following functions and/or methods:
<A NAME="lbAF">&nbsp;</A>
<H3>add_config</H3>



<A NAME="ixAAF"></A>
Dynamically add Apache configuration:
<P>



<PRE>
  $s-&gt;add_config($lines);

</PRE>


<DL COMPACT>
<DT>obj: $s ( Apache2::ServerRec object )<DD>


<A NAME="ixAAG"></A>

<DT>arg1: $lines ( <FONT SIZE="-1">ARRAY</FONT> ref )<DD>


<A NAME="ixAAH"></A>

An <FONT SIZE="-1">ARRAY</FONT> reference containing configuration lines per element, without
the new line terminators.
<DT>ret: no return value<DD>
<A NAME="ixAAI"></A>

<DT>since: 2.0.00<DD>
<A NAME="ixAAJ"></A>

</DL>
<P>

See also:
<TT>&quot;$r-&gt;add_config&quot;</TT>
<P>

For example:
<P>

Add a configuration section at the server startup (e.g. from
<I>startup.pl</I>):
<P>



<PRE>
  use Apache2::ServerUtil ();
  my $conf = &lt;&lt;'EOC';
  PerlModule Apache2::MyExample
  &lt;Location /perl&gt;
    SetHandler perl-script
    PerlResponseHandler Apache2::MyExample
  &lt;/Location&gt;
  EOC
  Apache2::ServerUtil-&gt;server-&gt;add_config([split /\n/, $conf]);

</PRE>


<A NAME="lbAG">&nbsp;</A>
<H3>add_version_component</H3>



<A NAME="ixAAK"></A>
Add a component to the version string
<P>



<PRE>
  $s-&gt;add_version_component($component);

</PRE>


<DL COMPACT>
<DT>obj: $s ( Apache2::ServerRec object )<DD>


<A NAME="ixAAL"></A>

<DT>arg1: $component ( string )<DD>


<A NAME="ixAAM"></A>

The string component to add
<DT>ret: no return value<DD>
<A NAME="ixAAN"></A>

<DT>since: 2.0.00<DD>
<A NAME="ixAAO"></A>

</DL>
<P>

This function is usually used by modules to advertise themselves to
the world. It's picked up by such statistics collectors, like
netcraft.com, which accomplish that by connecting to various servers
and grabbing the server version response header (<TT>&quot;Server&quot;</TT>). Some
servers choose to fully or partially conceal that header.
<P>

This method should be invoked in the
<TT>&quot;PerlPostConfigHandler&quot;</TT>
phase, which will ensure that the Apache core version number will
appear first.
<P>

For example let's add a component <I>``Hikers, Inc/0.99999''</I> to the
server string at the server startup:
<P>



<PRE>
  use Apache2::ServerUtil ();
  use Apache2::Const -compile =&gt; 'OK';
  
  Apache2::ServerUtil-&gt;server-&gt;push_handlers(
      PerlPostConfigHandler =&gt; \&amp;add_my_version);
  
  sub add_my_version {
      my ($conf_pool, $log_pool, $temp_pool, $s) = @_;
      $s-&gt;add_version_component(&quot;Hikers, Inc/0.99999&quot;);
      return Apache2::Const::OK;
  }

</PRE>


<P>

or of course you could register the
<TT>&quot;PerlPostConfigHandler&quot;</TT>
handler directly in <I>httpd.conf</I>
<P>

Now when the server starts, you will something like:
<P>



<PRE>
  [Thu Jul 15 12:15:28 2004] [notice] Apache/2.0.51-dev (Unix)
  mod_perl/1.99_15-dev Perl/v5.8.5 Hikers, Inc/0.99999
  configured -- resuming normal operations

</PRE>


<P>

Also remember that the <TT>&quot;ServerTokens&quot;</TT> directive value controls
whether the component information is displayed or not.
<A NAME="lbAH">&nbsp;</A>
<H3>dir_config</H3>



<A NAME="ixAAP"></A>
<TT>&quot;$s-&gt;dir_config()&quot;</TT> provides an interface for the per-server
variables specified by the <TT>&quot;PerlSetVar&quot;</TT> and <TT>&quot;PerlAddVar&quot;</TT> directives,
and also can be manipulated via the
<TT>&quot;APR::Table&quot;</TT> methods.
<P>



<PRE>
  $table  = $s-&gt;dir_config();
  $value  = $s-&gt;dir_config($key);
  @values = $s-&gt;dir_config($key);
  $s-&gt;dir_config($key, $val);

</PRE>


<DL COMPACT>
<DT>obj: $s ( Apache2::ServerRec object )<DD>


<A NAME="ixAAQ"></A>

<DT>opt arg2: $key ( string )<DD>


<A NAME="ixAAR"></A>

Key string
<DT>opt arg3: $val ( string )<DD>


<A NAME="ixAAS"></A>
Value string
<DT>ret: ...<DD>
<A NAME="ixAAT"></A>
Depends on the passed arguments, see further discussion
<DT>since: 2.0.00<DD>
<A NAME="ixAAU"></A>
</DL>
<P>

The keys are case-insensitive.
<P>



<PRE>
  $t = $s-&gt;dir_config();

</PRE>


<P>

<I>dir_config()</I> called in a scalar context without the <TT>$key</TT> argument
returns a <I></I><FONT SIZE="-1"><I>HASH</I></FONT><I></I> reference blessed into the <I>APR::Table</I> class. This
object can be manipulated via the <I>APR::Table</I> methods. For available
methods see <I>APR::Table</I>.
<P>



<PRE>
  @values = $s-&gt;dir_config($key);

</PRE>


<P>

If the <TT>$key</TT> argument is passed in the list context a list of all
matching values will be returned. This method is ineffective for big
tables, as it does a linear search of the table. Thefore avoid using
this way of calling <I>dir_config()</I> unless you know that there could be
more than one value for the wanted key and all the values are wanted.
<P>



<PRE>
  $value = $s-&gt;dir_config($key);

</PRE>


<P>

If the <TT>$key</TT> argument is passed in the scalar context only a single
value will be returned. Since the table preserves the insertion order,
if there is more than one value for the same key, the oldest value
assosiated with the desired key is returned. Calling in the scalar
context is also much faster, as it'll stop searching the table as soon
as the first match happens.
<P>



<PRE>
  $s-&gt;dir_config($key =&gt; $val);

</PRE>


<P>

If the <TT>$key</TT> and the <TT>$val</TT> arguments are used, the <I>set()</I> operation
will happen: all existing values associated with the key <TT>$key</TT> (and
the key itself) will be deleted and <TT>$value</TT> will be placed instead.
<P>



<PRE>
  $s-&gt;dir_config($key =&gt; undef);

</PRE>


<P>

If <TT>$val</TT> is <I>undef</I> the <I>unset()</I> operation will happen: all existing
values associated with the key <TT>$key</TT> (and the key itself) will be
deleted.
<A NAME="lbAI">&nbsp;</A>
<H3>exists_config_define</H3>



<A NAME="ixAAV"></A>
Check for a definition from the server startup command line
(e.g. <TT>&quot;-DMODPERL2&quot;</TT>)
<P>



<PRE>
  $result = Apache2::ServerUtil::exists_config_define($name);

</PRE>


<DL COMPACT>
<DT>arg1: $name ( string )<DD>


<A NAME="ixAAW"></A>
The define string to check for
<DT>ret: $result ( boolean )<DD>


<A NAME="ixAAX"></A>
true if defined, false otherwise
<DT>since: 2.0.00<DD>
<A NAME="ixAAY"></A>
</DL>
<P>

For example:
<P>



<PRE>
  print &quot;this is mp2&quot;
      if Apache2::ServerUtil::exists_config_define('MODPERL2');

</PRE>


<A NAME="lbAJ">&nbsp;</A>
<H3>get_handlers</H3>



<A NAME="ixAAZ"></A>
Returns a reference to a list of handlers enabled for
a given phase.
<P>



<PRE>
  $handlers_list = $s-&gt;get_handlers($hook_name);

</PRE>


<DL COMPACT>
<DT>obj: $s ( Apache2::ServerRec object )<DD>


<A NAME="ixABA"></A>

<DT>arg1: $hook_name ( string )<DD>


<A NAME="ixABB"></A>

a string representing the phase to handle.
<DT>ret: $handlers_list (ref to an <FONT SIZE="-1">ARRAY</FONT> of <FONT SIZE="-1">CODE</FONT> refs)<DD>


<A NAME="ixABC"></A>
a list of references to the handler subroutines
<DT>since: 2.0.00<DD>
<A NAME="ixABD"></A>
</DL>
<P>

See also:
<TT>&quot;$r-&gt;add_config&quot;</TT>
<P>

For example:
<P>

A list of handlers configured to run at the <I>child_exit</I> phase:
<P>



<PRE>
  @handlers = @{ $s-&gt;get_handlers('PerlChildExitHandler') || []};

</PRE>


<A NAME="lbAK">&nbsp;</A>
<H3>get_server_built</H3>



<A NAME="ixABE"></A>
Get the date and time that the server was built
<P>



<PRE>
  $when_built = Apache2::ServerUtil::get_server_built();

</PRE>


<DL COMPACT>
<DT>ret: $when_built ( string )<DD>


<A NAME="ixABF"></A>
The server build time string
<DT>since: 2.0.00<DD>
<A NAME="ixABG"></A>
</DL>
<A NAME="lbAL">&nbsp;</A>
<H3>get_server_version</H3>



<A NAME="ixABH"></A>
Get the server version string
<P>



<PRE>
  $version = Apache2::ServerUtil::get_server_version();

</PRE>


<DL COMPACT>
<DT>ret: $version ( string )<DD>


<A NAME="ixABI"></A>
The server version string
<DT>since: 2.0.00<DD>
<A NAME="ixABJ"></A>
</DL>
<A NAME="lbAM">&nbsp;</A>
<H3>get_server_banner</H3>



<A NAME="ixABK"></A>
Get the server banner
<P>



<PRE>
 $banner = Apache2::ServerUtil::get_server_banner();

</PRE>


<DL COMPACT>
<DT>ret: $banner ( string )<DD>


<A NAME="ixABL"></A>
The server banner
<DT>since: 2.0.4<DD>
<A NAME="ixABM"></A>
</DL>
<A NAME="lbAN">&nbsp;</A>
<H3>get_server_description</H3>



<A NAME="ixABN"></A>
Get the server description
<P>



<PRE>
 $description = Apache2::ServerUtil::get_server_description();

</PRE>


<DL COMPACT>
<DT>ret: $description ( string )<DD>


<A NAME="ixABO"></A>
The server description
<DT>since: 2.0.4<DD>
<A NAME="ixABP"></A>
</DL>
<A NAME="lbAO">&nbsp;</A>
<H3>group_id</H3>



<A NAME="ixABQ"></A>
Get the group id corresponding to the <TT>&quot;Group&quot;</TT> directive in
<I>httpd.conf</I>:
<P>



<PRE>
  $gid = Apache2::ServerUtil-&gt;group_id;

</PRE>


<DL COMPACT>
<DT>obj: Apache2::ServerUtil (class name)<DD>


<A NAME="ixABR"></A>

<DT>ret: $gid ( integer )<DD>


<A NAME="ixABS"></A>

On Unix platforms returns the gid corresponding to the value used in
the <TT>&quot;Group&quot;</TT> directive in <I>httpd.conf</I>. On other platforms returns 0.
<DT>since: 2.0.03<DD>
<A NAME="ixABT"></A>
</DL>
<A NAME="lbAP">&nbsp;</A>
<H3>is_perl_option_enabled</H3>



<A NAME="ixABU"></A>
check whether a server level <TT>&quot;PerlOptions&quot;</TT> flag is enabled or not.
<P>



<PRE>
  $result = $s-&gt;is_perl_option_enabled($flag);

</PRE>


<DL COMPACT>
<DT>obj: $s ( Apache2::ServerRec object )<DD>


<A NAME="ixABV"></A>

<DT>arg1: $flag ( string )<DD>


<A NAME="ixABW"></A>
<DT>ret: $result ( boolean )<DD>


<A NAME="ixABX"></A>
<DT>since: 2.0.00<DD>
<A NAME="ixABY"></A>

</DL>
<P>

For example to check whether the <TT>&quot;ChildExit&quot;</TT> hook is enabled (which
can be disabled with <TT>&quot;PerlOptions -ChildExit&quot;</TT>) and configure some
handlers to run if enabled:
<P>



<PRE>
  $s-&gt;push_handlers(ChildExit =&gt; \&amp;child_exit)
      if $s-&gt;is_perl_option_enabled('ChildExit');

</PRE>


<P>

See also:
PerlOptions and
the equivalent function for directory level PerlOptions
flags.
<A NAME="lbAQ">&nbsp;</A>
<H3>method_register</H3>



<A NAME="ixABZ"></A>
Register a new request method, and return the offset that will be
associated with that method.
<P>



<PRE>
  $offset = $s-&gt;method_register($methname);

</PRE>


<DL COMPACT>
<DT>obj: $s ( Apache2::ServerRec object )<DD>


<A NAME="ixACA"></A>

<DT>arg1: $methname ( string )<DD>


<A NAME="ixACB"></A>

The name of the new method to register (in addition to the already
supported <TT>&quot;GET&quot;</TT>, <TT>&quot;HEAD&quot;</TT>, etc.)
<DT>ret: $offset ( integer )<DD>


<A NAME="ixACC"></A>
An int value representing an offset into a bitmask. You can probably
ignore it.
<DT>since: 2.0.00<DD>
<A NAME="ixACD"></A>
</DL>
<P>

This method allows you to extend the <FONT SIZE="-1">HTTP</FONT> protocol to support new
methods, which fit the <FONT SIZE="-1">HTTP</FONT> paradigm.  Of course you will need to
write a client that understands that protocol extension.  For a good
example, refer to the <TT>&quot;MyApache2::SendEmail&quot;</TT> example presented in
<TT>&quot;the PerlHeaderParserHandler
section&quot;</TT>,
which demonstrates how a new method <TT>&quot;EMAIL&quot;</TT> is registered and used.
<A NAME="lbAR">&nbsp;</A>
<H3>push_handlers</H3>



<A NAME="ixACE"></A>
Add one or more handlers to a list of handlers to be called for a
given phase.
<P>



<PRE>
  $ok = $s-&gt;push_handlers($hook_name =&gt; \&amp;handler);
  $ok = $s-&gt;push_handlers($hook_name =&gt; [\&amp;handler, \&amp;handler2]);

</PRE>


<DL COMPACT>
<DT>obj: $s ( Apache2::ServerRec object )<DD>


<A NAME="ixACF"></A>

<DT>arg1: $hook_name ( string )<DD>


<A NAME="ixACG"></A>

the phase to add the handlers to
<DT>arg2: $handlers ( <FONT SIZE="-1">CODE</FONT> ref or <FONT SIZE="-1">SUB</FONT> name or an <FONT SIZE="-1">ARRAY</FONT> ref )<DD>


<A NAME="ixACH"></A>
a single handler <FONT SIZE="-1">CODE</FONT> reference or just a name of the subroutine
(fully qualified unless defined in the current package).


<P>


if more than one passed, use a reference to an array of <FONT SIZE="-1">CODE</FONT> refs
and/or subroutine names.
<DT>ret: $ok ( boolean )<DD>


<A NAME="ixACI"></A>
returns a true value on success, otherwise a false value
<DT>since: 2.0.00<DD>
<A NAME="ixACJ"></A>
</DL>
<P>

See also:
<TT>&quot;$r-&gt;add_config&quot;</TT>
<P>

Examples:
<P>

A single handler:
<P>



<PRE>
  $s-&gt;push_handlers(PerlChildExitHandler =&gt; \&amp;handler);

</PRE>


<P>

Multiple handlers:
<P>



<PRE>
  $s-&gt;push_handlers(PerlChildExitHandler =&gt; ['Foo::Bar::handler', \&amp;handler2]);

</PRE>


<P>

Anonymous functions:
<P>



<PRE>
  $s-&gt;push_handlers(PerlLogHandler =&gt; sub { return Apache2::Const::OK });

</PRE>


<A NAME="lbAS">&nbsp;</A>
<H3>restart_count</H3>



<A NAME="ixACK"></A>
How many times the server was restarted.
<P>



<PRE>
  $restart_count = Apache2::ServerUtil::restart_count();

</PRE>


<DL COMPACT>
<DT>ret: restart_count ( number )<DD>


<A NAME="ixACL"></A>

<DT>since: 2.0.00<DD>
<A NAME="ixACM"></A>

</DL>
<P>

The following demonstration should make it clear what values to expect
from this function. Let's add the following code to <I>startup.pl</I>, so
it's run every time <I>httpd.conf</I> is parsed:
<P>



<PRE>
  use Apache2::ServerUtil ();
  my $cnt = Apache2::ServerUtil::restart_count();
  open my $fh, &quot;&gt;&gt;/tmp/out&quot; or die &quot;$!&quot;;
  print $fh &quot;cnt: $cnt\n&quot;;
  close $fh;

</PRE>


<P>

Now let's run a series of server starts and restarts and look at what
is logged into <I>/tmp/out</I>:
<P>



<PRE>
  % httpd -k start
  cnt: 1
  cnt: 2
  
  % httpd -k graceful
  cnt: 1
  cnt: 3
  
  % httpd -k graceful
  cnt: 1
  cnt: 4
  
  % httpd -k stop
  cnt: 1

</PRE>


<P>

Remembering that Apache restarts itself immediately after
starting, we can
see that the <TT>&quot;restart_count&quot;</TT> goes from 1 to 2 during the server
start. Moreover we can see that every operation forces the parsing of
<I>httpd.conf</I> and therefore reinitialization of mod_perl (and running
all the code found in <I>httpd.conf</I>). This happens even when the
server is shutdown via <TT>&quot;httpd -k stop&quot;</TT>.
<P>

What conclusions can be drawn from this demonstration:
<DL COMPACT>
<DT>*<DD>
<TT>&quot;Apache2::ServerUtil::restart_count()&quot;</TT> returns 1 every time some <TT>&quot;-k&quot;</TT>
command is passed to Apache (or <TT>&quot;kill -USR1&quot;</TT> or some alternative
signal is received).
<DT>*<DD>
At all other times the count will be 2 or higher. So for example on
graceful restart the count will be 3 or higher.
</DL>
<P>

For example if you want to run something every time <TT>&quot;httpd -k&quot;</TT> is run
you just need to check whether <TT>&quot;restart_count()&quot;</TT> returns 1:
<P>



<PRE>
  my $cnt = Apache2::ServerUtil::restart_count();
  do_something() if $cnt == 1;

</PRE>


<P>

To do something only when server restarts (<TT>&quot;httpd -k start&quot;</TT> or
<TT>&quot;httpd -k graceful)&quot;</TT>, check whether <TT>&quot;restart_count()&quot;</TT> is bigger than
1:
<P>



<PRE>
  my $cnt = Apache2::ServerUtil::restart_count();
  do_something() if $cnt &gt; 1;

</PRE>


<A NAME="lbAT">&nbsp;</A>
<H3>server</H3>



<A NAME="ixACN"></A>
Get the main server's object
<P>



<PRE>
  $main_s = Apache2::ServerUtil-&gt;server();

</PRE>


<DL COMPACT>
<DT>obj: Apache2::ServerUtil (class name)<DD>


<A NAME="ixACO"></A>

<DT>ret: $main_s ( Apache2::ServerRec object )<DD>


<A NAME="ixACP"></A>
<DT>since: 2.0.00<DD>
<A NAME="ixACQ"></A>

</DL>
<A NAME="lbAU">&nbsp;</A>
<H3>server_root</H3>



<A NAME="ixACR"></A>
returns the value set by the top-level <TT>&quot;ServerRoot&quot;</TT> directive.
<P>



<PRE>
  $server_root = Apache2::ServerUtil::server_root();

</PRE>


<DL COMPACT>
<DT>ret: $server_root ( string )<DD>


<A NAME="ixACS"></A>

<DT>since: 2.0.00<DD>
<A NAME="ixACT"></A>

</DL>
<A NAME="lbAV">&nbsp;</A>
<H3>server_root_relative</H3>



<A NAME="ixACU"></A>
Returns the canonical form of the filename made absolute to
<TT>&quot;ServerRoot&quot;</TT>:
<P>



<PRE>
  $path = Apache2::ServerUtil::server_root_relative($pool, $fname);

</PRE>


<DL COMPACT>
<DT>arg1: $pool ( APR::Pool object )<DD>


<A NAME="ixACV"></A>
Make sure that you read the following explanation and understand well
which pool object you need to pass before using this function.
<DT>opt arg2: $fname ( string )<DD>


<A NAME="ixACW"></A>

<DT>ret: $path ( string )<DD>


<A NAME="ixACX"></A>

The concatenation of <TT>&quot;ServerRoot&quot;</TT> and the <TT>$fname</TT>.


<P>


If <TT>$fname</TT> is not specified, the value of <TT>&quot;ServerRoot&quot;</TT> is returned
with a trailing <TT>&quot;/&quot;</TT>. (it's the same as using <TT>''</TT> as <TT>$fname</TT>'s
value).
<DT>since: 2.0.00<DD>
<A NAME="ixACY"></A>
</DL>
<P>

<TT>$fname</TT> is appended to the value of <TT>&quot;ServerRoot&quot;</TT> and returned. For
example:
<P>



<PRE>
  my $dir = Apache2::ServerUtil::server_root_relative($r-&gt;pool, 'logs');

</PRE>


<P>

You must be extra-careful when using this function. If you aren't sure
what you are doing don't use it.
<P>

It's much safer to build the path by yourself using use
<TT>&quot;Apache2::ServerUtil::server_root()&quot;</TT>, For
example:
<P>



<PRE>
  use File::Spec::Functions qw(catfile);
  my $path = catfile Apache2::ServerUtil::server_root, qw(t logs);

</PRE>


<P>

In this example, no memory allocation happens on the Apache-side and
you aren't risking to get a memory leak.
<P>

The problem with <TT>&quot;server_root_relative&quot;</TT> is that Apache allocates
memory to concatenate the path string. The memory is allocated from
the pool object. If you call this method on the server pool object
it'll allocate the memory from it.  If you do that at the server
startup, it's perfectly right, since you will do that only
once. However if you do that from within a request or a connection
handler, you create a memory leak every time it is called --- as the
memory gets allocated from the server pool, it will be freed only when
the server is shutdown. Therefore if you need to build a relative to
the root server path for the duration of the request, use the request
pool:
<P>



<PRE>
  use Apache2::RequestRec ();
  Apache2::ServerUtil::server_root_relative($r-&gt;pool, $fname);

</PRE>


<P>

If you need to have the path for the duration of a connection
(e.g. inside a protocol handler), you should use:
<P>



<PRE>
  use Apache2::Connection ();
  Apache2::ServerUtil::server_root_relative($c-&gt;pool, $fname);

</PRE>


<P>

And if you want it for the scope of the server file:
<P>



<PRE>
  use Apache2::Process ();
  use Apache2::ServerUtil ();
  Apache2::ServerUtil::server_root_relative($s-&gt;process-&gt;pool, $fname);

</PRE>


<P>

Moreover, you could have encountered the opposite problem, where you
have used a short-lived pool object to construct the path, but tried
to use the resulting path variable, when that pool has been destructed
already. In order to avoid mysterious segmentation faults, mod_perl
does a wasteful copy of the path string when returning it to you ---
another reason to avoid using this function.
<A NAME="lbAW">&nbsp;</A>
<H3>server_shutdown_cleanup_register</H3>



<A NAME="ixACZ"></A>
Register server shutdown cleanup callback:
<P>



<PRE>
  Apache2::ServerUtil::server_shutdown_cleanup_register($sub);

</PRE>


<DL COMPACT>
<DT>arg1: $sub ( <FONT SIZE="-1">CODE</FONT> ref or <FONT SIZE="-1">SUB</FONT> name )<DD>


<A NAME="ixADA"></A>

<DT>ret: no return value<DD>
<A NAME="ixADB"></A>
<DT>since: 2.0.00<DD>
<A NAME="ixADC"></A>

</DL>
<P>

This function can be used to register a callback to be run once at the
server shutdown (compared to
<TT>&quot;PerlChildExitHandler&quot;</TT>
which will execute the callback for each exiting child process).
<P>

For example in order to arrange the function <TT>&quot;do_my_cleanups()&quot;</TT> to be
run every time the server shuts down (or restarts), run the following
code at the server startup:
<P>



<PRE>
  Apache2::ServerUtil::server_shutdown_cleanup_register(\&amp;do_my_cleanups);

</PRE>


<P>

It's necessary to run this code at the server startup (normally
<I>startup.pl</I>. The function will croak if run after the
<TT>&quot;PerlPostConfigHandler&quot;</TT>
phase.
<A NAME="lbAX">&nbsp;</A>
<H3>set_handlers</H3>



<A NAME="ixADD"></A>
Set a list of handlers to be called for a given phase. Any previously
set handlers are forgotten.
<P>



<PRE>
  $ok = $s-&gt;set_handlers($hook_name =&gt; \&amp;handler);
  $ok = $s-&gt;set_handlers($hook_name =&gt; [\&amp;handler, \&amp;handler2]);
  $ok = $s-&gt;set_handlers($hook_name =&gt; []);
  $ok = $s-&gt;set_handlers($hook_name =&gt; undef);

</PRE>


<DL COMPACT>
<DT>obj: $s ( Apache2::ServerRec object )<DD>


<A NAME="ixADE"></A>

<DT>arg1: $hook_name ( string )<DD>


<A NAME="ixADF"></A>

the phase to set the handlers in
<DT>arg2: $handlers ( <FONT SIZE="-1">CODE</FONT> ref or <FONT SIZE="-1">SUB</FONT> name or an <FONT SIZE="-1">ARRAY</FONT> ref )<DD>


<A NAME="ixADG"></A>
a reference to a single handler <FONT SIZE="-1">CODE</FONT> reference or just a name of the
subroutine (fully qualified unless defined in the current package).


<P>


if more than one passed, use a reference to an array of <FONT SIZE="-1">CODE</FONT> refs
and/or subroutine names.


<P>


if the argument is <TT>&quot;undef&quot;</TT> or <TT>&quot;[]&quot;</TT> the list of handlers is reset to
zero.
<DT>ret: $ok ( boolean )<DD>


<A NAME="ixADH"></A>
returns a true value on success, otherwise a false value
<DT>since: 2.0.00<DD>
<A NAME="ixADI"></A>
</DL>
<P>

See also:
<TT>&quot;$r-&gt;add_config&quot;</TT>
<P>

Examples:
<P>

A single handler:
<P>



<PRE>
  $r-&gt;set_handlers(PerlChildExitHandler =&gt; \&amp;handler);

</PRE>


<P>

Multiple handlers:
<P>



<PRE>
  $r-&gt;set_handlers(PerlFixupHandler =&gt; ['Foo::Bar::handler', \&amp;handler2]);

</PRE>


<P>

Anonymous functions:
<P>



<PRE>
  $r-&gt;set_handlers(PerlLogHandler =&gt; sub { return Apache2::Const::OK });

</PRE>


<P>

Reset any previously set handlers:
<P>



<PRE>
  $r-&gt;set_handlers(PerlCleanupHandler =&gt; []);

</PRE>


<P>

or
<P>



<PRE>
  $r-&gt;set_handlers(PerlCleanupHandler =&gt; undef);

</PRE>


<A NAME="lbAY">&nbsp;</A>
<H3>user_id</H3>



<A NAME="ixADJ"></A>
Get the user id corresponding to the <TT>&quot;User&quot;</TT> directive in
<I>httpd.conf</I>:
<P>



<PRE>
  $uid = Apache2::ServerUtil-&gt;user_id;

</PRE>


<DL COMPACT>
<DT>obj: Apache2::ServerUtil (class name)<DD>


<A NAME="ixADK"></A>

<DT>ret: $uid ( integer )<DD>


<A NAME="ixADL"></A>

On Unix platforms returns the uid corresponding to the value used in
the <TT>&quot;User&quot;</TT> directive in <I>httpd.conf</I>. On other platforms returns 0.
<DT>since: 2.0.03<DD>
<A NAME="ixADM"></A>
</DL>
<A NAME="lbAZ">&nbsp;</A>
<H2>Unsupported API</H2>

<A NAME="ixADN"></A>
<TT>&quot;Apache2::ServerUtil&quot;</TT> also provides auto-generated Perl interface for
a few other methods which aren't tested at the moment and therefore
their <FONT SIZE="-1">API</FONT> is a subject to change. These methods will be finalized
later as a need arises. If you want to rely on any of the following
methods please contact the the mod_perl development mailing
list so we can help each other take the steps necessary
to shift the method to an officially supported <FONT SIZE="-1">API</FONT>.
<A NAME="lbBA">&nbsp;</A>
<H3>error_log2stderr</H3>



<A NAME="ixADO"></A>
Start sending <FONT SIZE="-1">STDERR</FONT> to the error_log file
<P>



<PRE>
  $s-&gt;error_log2stderr();

</PRE>


<DL COMPACT>
<DT>obj: $s ( Apache2::ServerRec object )<DD>


<A NAME="ixADP"></A>
The current server
<DT>ret: no return value<DD>
<A NAME="ixADQ"></A>

<DT>since: 2.0.00<DD>
<A NAME="ixADR"></A>

</DL>
<P>

This method may prove useful if you want to start redirecting <FONT SIZE="-1">STDERR</FONT>
to the error_log file before Apache does that on the startup.
<A NAME="lbBB">&nbsp;</A>
<H2>See Also</H2>

<A NAME="ixADS"></A>
mod_perl 2.0 documentation.
<A NAME="lbBC">&nbsp;</A>
<H2>Copyright</H2>

<A NAME="ixADT"></A>
mod_perl 2.0 and its core modules are copyrighted under
The Apache Software License, Version 2.0.
<A NAME="lbBD">&nbsp;</A>
<H2>Authors</H2>

<A NAME="ixADU"></A>
The mod_perl development team and numerous
contributors.
<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">NAME</A><DD>
<DT><A HREF="#lbAC">Synopsis</A><DD>
<DT><A HREF="#lbAD">Description</A><DD>
<DT><A HREF="#lbAE">Methods API</A><DD>
<DL>
<DT><A HREF="#lbAF">add_config</A><DD>
<DT><A HREF="#lbAG">add_version_component</A><DD>
<DT><A HREF="#lbAH">dir_config</A><DD>
<DT><A HREF="#lbAI">exists_config_define</A><DD>
<DT><A HREF="#lbAJ">get_handlers</A><DD>
<DT><A HREF="#lbAK">get_server_built</A><DD>
<DT><A HREF="#lbAL">get_server_version</A><DD>
<DT><A HREF="#lbAM">get_server_banner</A><DD>
<DT><A HREF="#lbAN">get_server_description</A><DD>
<DT><A HREF="#lbAO">group_id</A><DD>
<DT><A HREF="#lbAP">is_perl_option_enabled</A><DD>
<DT><A HREF="#lbAQ">method_register</A><DD>
<DT><A HREF="#lbAR">push_handlers</A><DD>
<DT><A HREF="#lbAS">restart_count</A><DD>
<DT><A HREF="#lbAT">server</A><DD>
<DT><A HREF="#lbAU">server_root</A><DD>
<DT><A HREF="#lbAV">server_root_relative</A><DD>
<DT><A HREF="#lbAW">server_shutdown_cleanup_register</A><DD>
<DT><A HREF="#lbAX">set_handlers</A><DD>
<DT><A HREF="#lbAY">user_id</A><DD>
</DL>
<DT><A HREF="#lbAZ">Unsupported API</A><DD>
<DL>
<DT><A HREF="#lbBA">error_log2stderr</A><DD>
</DL>
<DT><A HREF="#lbBB">See Also</A><DD>
<DT><A HREF="#lbBC">Copyright</A><DD>
<DT><A HREF="#lbBD">Authors</A><DD>
</DL>
<HR>
This document was created by
<A HREF="/manpages/index.html">man2html</A>,
using the manual pages.<BR>
Time: 05:33:11 GMT, December 24, 2015
</div></body>
</HTML>
