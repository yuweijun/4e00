<!DOCTYPE html>

<HTML><head><TITLE>Manpage of docs::api::ModPerl::Registry</TITLE>
<meta charset="utf-8">
<link rel="stylesheet" href="/css/main.css" type="text/css">
</head>
<body>
 <header class="site-header">
 <div class="wrap"> <div class="site-title"><a href="/manpages/index.html">linux man pages</a></div>
 <div class="site-description">{"type":"programming"}</div>
 </div>
 </header>
 <div class="page-content">
<H1>docs::api::ModPerl::Registry</H1>
Section: User Contributed Perl Documentation (3)<BR>Updated: 2007-11-12<BR><A HREF="#index">Index</A>
<A HREF="/manpages/index.html">Return to Main Contents</A><HR>






<A NAME="lbAB">&nbsp;</A>
<H2>NAME</H2>

ModPerl::Registry - Run unaltered CGI scripts persistently under mod_perl
<A NAME="lbAC">&nbsp;</A>
<H2>Synopsis</H2>

<A NAME="ixAAC"></A>


<PRE>
  # httpd.conf
  PerlModule ModPerl::Registry
  Alias /perl/ /home/httpd/perl/
  &lt;Location /perl&gt;
      SetHandler perl-script
      PerlResponseHandler ModPerl::Registry
      #PerlOptions +ParseHeaders
      #PerlOptions -GlobalRequest
      Options +ExecCGI
  &lt;/Location&gt;

</PRE>


<A NAME="lbAD">&nbsp;</A>
<H2>Description</H2>

<A NAME="ixAAD"></A>
URIs in the form of <TT>&quot;<A HREF="http://example.com/perl/test.pl">http://example.com/perl/test.pl</A>&quot;</TT> will be
compiled as the body of a Perl subroutine and executed.  Each child
process will compile the subroutine once and store it in memory. It
will recompile it whenever the file (e.g. <I>test.pl</I> in our example)
is updated on disk.  Think of it as an object oriented server with
each script implementing a class loaded at runtime.
<P>

The file looks much like a ``normal'' script, but it is compiled into a
subroutine.
<P>

For example:
<P>



<PRE>
  my $r = Apache2::RequestUtil-&gt;request;
  $r-&gt;content_type(&quot;text/html&quot;);
  $r-&gt;send_http_header;
  $r-&gt;print(&quot;mod_perl rules!&quot;);

</PRE>


<P>

<FONT SIZE="-1">XXX:</FONT> <FONT SIZE="-1">STOPPED</FONT> here. Below is the old Apache::Registry document which I
haven't worked through yet.
<P>

<FONT SIZE="-1">META:</FONT> document that for now we don't <I>chdir()</I> into the script's dir,
because it affects the whole process under
threads. <TT>&quot;ModPerl::RegistryPrefork&quot;</TT>
should be used by those who run only under prefork <FONT SIZE="-1">MPM</FONT>.
<P>

This module emulates the <FONT SIZE="-1">CGI</FONT> environment, allowing programmers to
write scripts that run under <FONT SIZE="-1">CGI</FONT> or mod_perl without change.  Existing
<FONT SIZE="-1">CGI</FONT> scripts may require some changes, simply because a <FONT SIZE="-1">CGI</FONT> script has
a very short lifetime of one <FONT SIZE="-1">HTTP</FONT> request, allowing you to get away
with ``quick and dirty'' scripting.  Using mod_perl and ModPerl::Registry
requires you to be more careful, but it also gives new meaning to the
word ``quick''!
<P>

Be sure to read all mod_perl related documentation for more details,
including instructions for setting up an environment that looks
exactly like <FONT SIZE="-1">CGI:</FONT>
<P>



<PRE>
 print &quot;Content-type: text/html\n\n&quot;;
 print &quot;Hi There!&quot;;

</PRE>


<P>

Note that each httpd process or ``child'' must compile each script once,
so the first request to one server may seem slow, but each request
there after will be faster.  If your scripts are large and/or make use
of many Perl modules, this difference should be noticeable to the
human eye.
<A NAME="lbAE">&nbsp;</A>
<H2>DirectoryIndex</H2>

<A NAME="ixAAE"></A>
If you are trying setup a DirectoryIndex under a Location
covered by ModPerl::Registry* you might run into some trouble.
<P>

<FONT SIZE="-1">META:</FONT> if this gets added to core, replace with real documenation.
See <A HREF="http://marc.theaimsgroup.com/?l=apache-modperl">http://marc.theaimsgroup.com/?l=apache-modperl</A>&amp;m=112805393100758&amp;w=2
<A NAME="lbAF">&nbsp;</A>
<H2>Special Blocks</H2>

<A NAME="ixAAF"></A>
<A NAME="lbAG">&nbsp;</A>
<H3>BEGIN Blocks</H3>



<A NAME="ixAAG"></A>
<TT>&quot;BEGIN&quot;</TT> blocks defined in scripts running under the
<TT>&quot;ModPerl::Registry&quot;</TT> handler behave similarly to the normal mod_perl
handlers plus:
<DL COMPACT>
<DT>*<DD>
Only once, if pulled in by the parent process via
<TT>&quot;Apache2::RegistryLoader&quot;</TT>.
<DT>*<DD>
An additional time, once per child process or Perl interpreter, each
time the script file changes on disk.
</DL>
<P>

<TT>&quot;BEGIN&quot;</TT> blocks defined in modules loaded from <TT>&quot;ModPerl::Registry&quot;</TT>
scripts behave identically to the normal mod_perl
handlers, regardless
of whether they define a package or not.
<A NAME="lbAH">&nbsp;</A>
<H3>CHECK and INIT Blocks</H3>



<A NAME="ixAAH"></A>
Same as normal mod_perl
handlers.
<A NAME="lbAI">&nbsp;</A>
<H3>END Blocks</H3>



<A NAME="ixAAI"></A>
<TT>&quot;END&quot;</TT> blocks encountered during compilation of a script, are called
after the script has completed its run, including subsequent
invocations when the script is cached in memory. This is assuming that
the script itself doesn't define a package on its own. If the script
defines its own package, the <TT>&quot;END&quot;</TT> blocks in the scope of that
package will be executed at the end of the interpretor's life.
<P>

<TT>&quot;END&quot;</TT> blocks residing in modules loaded by registry script will be
executed only once, when the interpreter exits.
<A NAME="lbAJ">&nbsp;</A>
<H2>Security</H2>

<A NAME="ixAAJ"></A>
<TT>&quot;ModPerl::Registry::handler&quot;</TT> performs the same sanity checks as
mod_cgi does, before running the script.
<A NAME="lbAK">&nbsp;</A>
<H2>Environment</H2>

<A NAME="ixAAK"></A>
The Apache function `exit' overrides the Perl core built-in function.
<A NAME="lbAL">&nbsp;</A>
<H2>Commandline Switches In First Line</H2>

<A NAME="ixAAL"></A>
Normally when a Perl script is run from the command line or under <FONT SIZE="-1">CGI</FONT>,
arguments on the `#!' line are passed to the perl interpreter for processing.
<P>

<TT>&quot;ModPerl::Registry&quot;</TT> currently only honors the <B>-w</B> switch and will
enable the <TT>&quot;warnings&quot;</TT> pragma in such case.
<P>

Another common switch used with <FONT SIZE="-1">CGI</FONT> scripts is <B>-T</B> to turn on taint
checking.  This can only be enabled when the server starts with the
configuration directive:
<P>



<PRE>
 PerlSwitches -T

</PRE>


<P>

However, if taint checking is not enabled, but the <B>-T</B> switch is
seen, <TT>&quot;ModPerl::Registry&quot;</TT> will write a warning to the <I>error_log</I>
file.
<A NAME="lbAM">&nbsp;</A>
<H2>Debugging</H2>

<A NAME="ixAAM"></A>
You may set the debug level with the <TT>$ModPerl::Registry::Debug</TT> bitmask
<P>



<PRE>
 1 =&gt; log recompile in errorlog
 2 =&gt; ModPerl::Debug::dump in case of $@
 4 =&gt; trace pedantically

</PRE>


<A NAME="lbAN">&nbsp;</A>
<H2>Caveats</H2>

<A NAME="ixAAN"></A>
ModPerl::Registry makes things look just the <FONT SIZE="-1">CGI</FONT> environment, however, you
must understand that this *is not CGI*.  Each httpd child will compile
your script into memory and keep it there, whereas <FONT SIZE="-1">CGI</FONT> will run it once,
cleaning out the entire process space.  Many times you have heard
&quot;always use <TT>&quot;-w&quot;</TT>, always use <TT>&quot;-w&quot;</TT> and 'use strict'&quot;.
This is more important here than anywhere else!
<A NAME="lbAO">&nbsp;</A>
<H2>Authors</H2>

<A NAME="ixAAO"></A>
Andreas J. Koenig, Doug MacEachern and Stas Bekman.
<A NAME="lbAP">&nbsp;</A>
<H2>See Also</H2>

<A NAME="ixAAP"></A>
<TT>&quot;ModPerl::RegistryCooker&quot;</TT>,
<TT>&quot;ModPerl::RegistryBB&quot;</TT> and
<TT>&quot;ModPerl::PerlRun&quot;</TT>.
<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">NAME</A><DD>
<DT><A HREF="#lbAC">Synopsis</A><DD>
<DT><A HREF="#lbAD">Description</A><DD>
<DT><A HREF="#lbAE">DirectoryIndex</A><DD>
<DT><A HREF="#lbAF">Special Blocks</A><DD>
<DL>
<DT><A HREF="#lbAG">BEGIN Blocks</A><DD>
<DT><A HREF="#lbAH">CHECK and INIT Blocks</A><DD>
<DT><A HREF="#lbAI">END Blocks</A><DD>
</DL>
<DT><A HREF="#lbAJ">Security</A><DD>
<DT><A HREF="#lbAK">Environment</A><DD>
<DT><A HREF="#lbAL">Commandline Switches In First Line</A><DD>
<DT><A HREF="#lbAM">Debugging</A><DD>
<DT><A HREF="#lbAN">Caveats</A><DD>
<DT><A HREF="#lbAO">Authors</A><DD>
<DT><A HREF="#lbAP">See Also</A><DD>
</DL>
<HR>
This document was created by
<A HREF="/manpages/index.html">man2html</A>,
using the manual pages.<BR>
Time: 05:33:34 GMT, December 24, 2015
</div></body>
</HTML>
