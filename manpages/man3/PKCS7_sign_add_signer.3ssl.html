<!DOCTYPE html>

<HTML><head><TITLE>Manpage of PKCS7_sign_add_signer</TITLE>
<meta charset="utf-8">
<link rel="stylesheet" href="/css/main.css" type="text/css">
</head>
<body>
 <header class="site-header">
 <div class="wrap"> <div class="site-title"><a href="/manpages/index.html">linux manpages</a></div>
 <div class="site-description">{"type":"documentation"}</div>
 </div>
 </header>
 <div class="page-content"><div class="wrap">
<H1>PKCS7_sign_add_signer</H1>
Section: OpenSSL (3)<BR>Updated: 2009-09-30<BR><A HREF="#index">Index</A>
<A HREF="/manpages/index.html">Return to Main Contents</A><HR>






<A NAME="lbAB">&nbsp;</A>
<H2>NAME</H2>

PKCS7_sign_add_signer - add a signer PKCS7 signed data structure.
<A NAME="lbAC">&nbsp;</A>
<H2>SYNOPSIS</H2>

<A NAME="ixAAC"></A>


<PRE>
 #include &lt;<A HREF="file:/usr/include/openssl/pkcs7.h">openssl/pkcs7.h</A>&gt;

 PKCS7_SIGNER_INFO *PKCS7_sign_add_signer(PKCS7 *p7, X509 *signcert, EVP_PKEY *pkey, const EVP_MD *md, int flags);

</PRE>


<A NAME="lbAD">&nbsp;</A>
<H2>DESCRIPTION</H2>

<A NAME="ixAAD"></A>
<I>PKCS7_sign_add_signer()</I> adds a signer with certificate <B>signcert</B> and private
key <B>pkey</B> using message digest <B>md</B> to a <FONT SIZE="-1">PKCS7</FONT> signed data structure
<B>p7</B>.
<P>

The <FONT SIZE="-1">PKCS7</FONT> structure should be obtained from an initial call to <I>PKCS7_sign()</I>
with the flag <B></B><FONT SIZE="-1"><B>PKCS7_PARTIAL</B></FONT><B></B> set or in the case or re-signing a valid <FONT SIZE="-1">PKCS7</FONT>
signed data structure.
<P>

If the <B>md</B> parameter is <B></B><FONT SIZE="-1"><B>NULL</B></FONT><B></B> then the default digest for the public
key algorithm will be used.
<P>

Unless the <B></B><FONT SIZE="-1"><B>PKCS7_REUSE_DIGEST</B></FONT><B></B> flag is set the returned <FONT SIZE="-1">PKCS7</FONT> structure
is not complete and must be finalized either by streaming (if applicable) or
a call to <I>PKCS7_final()</I>.
<A NAME="lbAE">&nbsp;</A>
<H2>NOTES</H2>

<A NAME="ixAAE"></A>
The main purpose of this function is to provide finer control over a PKCS#7
signed data structure where the simpler <I>PKCS7_sign()</I> function defaults are
not appropriate. For example if multiple signers or non default digest
algorithms are needed.
<P>

Any of the following flags (ored together) can be passed in the <B>flags</B>
parameter.
<P>

If <B></B><FONT SIZE="-1"><B>PKCS7_REUSE_DIGEST</B></FONT><B></B> is set then an attempt is made to copy the content
digest value from the <FONT SIZE="-1">PKCS7</FONT> struture: to add a signer to an existing structure.
An error occurs if a matching digest value cannot be found to copy. The
returned <FONT SIZE="-1">PKCS7</FONT> structure will be valid and finalized when this flag is set.
<P>

If <B></B><FONT SIZE="-1"><B>PKCS7_PARTIAL</B></FONT><B></B> is set in addition to <B></B><FONT SIZE="-1"><B>PKCS7_REUSE_DIGEST</B></FONT><B></B> then the 
<B></B><FONT SIZE="-1"><B>PKCS7_SIGNER_INO</B></FONT><B></B> structure will not be finalized so additional attributes
can be added. In this case an explicit call to <I>PKCS7_SIGNER_INFO_sign()</I> is
needed to finalize it.
<P>

If <B></B><FONT SIZE="-1"><B>PKCS7_NOCERTS</B></FONT><B></B> is set the signer's certificate will not be included in the
<FONT SIZE="-1">PKCS7</FONT> structure, the signer's certificate must still be supplied in the
<B>signcert</B> parameter though. This can reduce the size of the signature if the
signers certificate can be obtained by other means: for example a previously
signed message.
<P>

The signedData structure includes several PKCS#7 autenticatedAttributes
including the signing time, the PKCS#7 content type and the supported list of
ciphers in an SMIMECapabilities attribute. If <B></B><FONT SIZE="-1"><B>PKCS7_NOATTR</B></FONT><B></B> is set then no
authenticatedAttributes will be used. If <B></B><FONT SIZE="-1"><B>PKCS7_NOSMIMECAP</B></FONT><B></B> is set then just
the SMIMECapabilities are omitted.
<P>

If present the SMIMECapabilities attribute indicates support for the following
algorithms: triple <FONT SIZE="-1">DES</FONT>, 128 bit <FONT SIZE="-1">RC2</FONT>, 64 bit <FONT SIZE="-1">RC2</FONT>, <FONT SIZE="-1">DES</FONT> and 40 bit <FONT SIZE="-1">RC2</FONT>. If any of
these algorithms is disabled then it will not be included.
<P>

<I>PKCS7_sign_add_signers()</I> returns an internal pointer to the <FONT SIZE="-1">PKCS7_SIGNER_INFO</FONT>
structure just added, this can be used to set additional attributes 
before it is finalized.
<A NAME="lbAF">&nbsp;</A>
<H2>RETURN VALUES</H2>

<A NAME="ixAAF"></A>
<I>PKCS7_sign_add_signers()</I> returns an internal pointer to the <FONT SIZE="-1">PKCS7_SIGNER_INFO</FONT>
structure just added or <FONT SIZE="-1">NULL</FONT> if an error occurs.
<A NAME="lbAG">&nbsp;</A>
<H2>SEE ALSO</H2>

<A NAME="ixAAG"></A>
<I><A HREF="/manpages/index.html?3+ERR_get_error">ERR_get_error</A></I>(3), <I><A HREF="http://localhost/cgi-bin/man/man2html?3+PKCS7_sign">PKCS7_sign</A></I>(3),
<I><A HREF="/manpages/index.html?3+PKCS7_final">PKCS7_final</A></I>(3),
<A NAME="lbAH">&nbsp;</A>
<H2>HISTORY</H2>

<A NAME="ixAAH"></A>
<I>PPKCS7_sign_add_signer()</I> was added to OpenSSL 1.0.0
<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">NAME</A><DD>
<DT><A HREF="#lbAC">SYNOPSIS</A><DD>
<DT><A HREF="#lbAD">DESCRIPTION</A><DD>
<DT><A HREF="#lbAE">NOTES</A><DD>
<DT><A HREF="#lbAF">RETURN VALUES</A><DD>
<DT><A HREF="#lbAG">SEE ALSO</A><DD>
<DT><A HREF="#lbAH">HISTORY</A><DD>
</DL>
<HR>
This document was created by
<A HREF="/manpages/index.html">man2html</A>,
using the manual pages.<BR>
Time: 05:33:36 GMT, December 24, 2015
</div></div>
</body>
</HTML>
