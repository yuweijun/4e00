<!DOCTYPE html>

<HTML><head><TITLE>Manpage of RTIME</TITLE>
<meta charset="utf-8">
<link rel="stylesheet" href="/css/main.css" type="text/css">
</head>
<body>
 <header class="site-header">
 <div class="wrap"> <div class="site-title"><a href="/manpages/index.html">linux manpages</a></div>
 <div class="site-description">{"type":"documentation"}</div>
 </div>
 </header>
 <div class="page-content"><div class="wrap">
<H1>RTIME</H1>
Section: Linux Programmer's Manual (3)<BR>Updated: 2008-07-12<BR><A HREF="#index">Index</A>
<A HREF="/manpages/index.html">Return to Main Contents</A><HR>

<A NAME="lbAB">&nbsp;</A>
<H2>NAME</H2>

rtime - get time from a remote machine
<A NAME="lbAC">&nbsp;</A>
<H2>SYNOPSIS</H2>

<PRE>
<B>#include &lt;<A HREF="file:/usr/include/rpc/des_crypt.h">rpc/des_crypt.h</A>&gt;</B>

<B>int rtime(struct sockaddr_in *</B><I>addrp</I><B>, struct rpc_timeval *</B><I>timep</I><B>,</B>
<B>          struct rpc_timeval *</B><I>timeout</I><B>);</B>
</PRE>

<A NAME="lbAD">&nbsp;</A>
<H2>DESCRIPTION</H2>

This function uses the Time Server Protocol as described in
RFC&nbsp;868 to obtain the time from a remote machine.
<P>

The Time Server Protocol gives the time in seconds since
00:00:00 UTC, 1 Jan 1900,
and this function subtracts the appropriate constant in order to
convert the result to seconds since
00:00:00 UTC, 1 Jan 1970, the Unix Epoch.
<P>

When
<I>timeout</I>

is non-NULL, the udp/time socket (port 37) is used.
Otherwise, the tcp/time socket (port 37) is used.
<A NAME="lbAE">&nbsp;</A>
<H2>RETURN VALUE</H2>

On success, 0 is returned, and the obtained 32-bit time value is stored in
<I>timep-&gt;tv_sec</I>.

In case of error -1 is returned, and
<I>errno</I>

is set appropriately.
<A NAME="lbAF">&nbsp;</A>
<H2>ERRORS</H2>

All errors for underlying functions
(<B><A HREF="/manpages/index.html?2+sendto">sendto</A></B>(2),

<B><A HREF="/manpages/index.html?2+poll">poll</A></B>(2),

<B><A HREF="/manpages/index.html?2+recvfrom">recvfrom</A></B>(2),

<B><A HREF="/manpages/index.html?2+connect">connect</A></B>(2),

<B><A HREF="/manpages/index.html?2+read">read</A></B>(2))

can occur.
Moreover:
<DL COMPACT>
<DT><B>EIO</B>

<DD>
The number of returned bytes is not 4.
<DT><B>ETIMEDOUT</B>

<DD>
The waiting time as defined in timeout has expired.
</DL>
<A NAME="lbAG">&nbsp;</A>
<H2>NOTES</H2>

Only IPv4 is supported.
<P>

Some
<I>in.timed</I>

versions only support TCP.
Try the example program with
<I>use_tcp</I>

set to 1.
<P>

Libc5 uses the prototype
<BR>

int rtime(struct sockaddr_in *, struct timeval *, struct timeval *);
<BR>

and requires
<I>&lt;<A HREF="file:/usr/include/sys/time.h">sys/time.h</A>&gt;</I>

instead of
<I>&lt;<A HREF="file:/usr/include/rpc/auth_des.h">rpc/auth_des.h</A>&gt;</I>.

<A NAME="lbAH">&nbsp;</A>
<H2>BUGS</H2>

<B>rtime</B>()

in glibc 2.2.5 and earlier does not work properly on 64-bit machines.
<A NAME="lbAI">&nbsp;</A>
<H2>EXAMPLE</H2>

This example requires that port 37 is up and open.
You may check
that the time entry within
<I>/etc/inetd.conf</I>

is not commented out.
<BR>

The program connects to a computer called &quot;linux&quot;.
Using &quot;localhost&quot; does not work.
The result is the localtime of the computer &quot;linux&quot;.
<P>
<PRE>
#include &lt;<A HREF="file:/usr/include/stdio.h">stdio.h</A>&gt;
#include &lt;<A HREF="file:/usr/include/stdlib.h">stdlib.h</A>&gt;
#include &lt;<A HREF="file:/usr/include/errno.h">errno.h</A>&gt;
#include &lt;<A HREF="file:/usr/include/string.h">string.h</A>&gt;
#include &lt;<A HREF="file:/usr/include/time.h">time.h</A>&gt;
#include &lt;<A HREF="file:/usr/include/rpc/auth_des.h">rpc/auth_des.h</A>&gt;
#include &lt;<A HREF="file:/usr/include/netdb.h">netdb.h</A>&gt;

int use_tcp = 0;
char *servername = &quot;linux&quot;;

int
main(void)
{
    struct sockaddr_in name;
    struct rpc_timeval time1 = {0,0};
    struct rpc_timeval timeout = {1,0};
    struct hostent *hent;
    int ret;

    memset((char *) &amp;name, 0, sizeof(name));
    <A HREF="/manpages/index.html?1+sethostent">sethostent</A>(1);
    hent = gethostbyname(servername);
    memcpy((char *) &amp;name.sin_addr, hent-&gt;h_addr, hent-&gt;h_length);

    ret = rtime(&amp;name, &amp;time1, use_tcp ? NULL : &amp;timeout);
    if (ret &lt; 0)
        perror(&quot;rtime error&quot;);
    else
        printf(&quot;%s\n&quot;, ctime((time_t *) &amp;time1.tv_sec));

    exit(EXIT_SUCCESS);
}
</PRE>

<A NAME="lbAJ">&nbsp;</A>
<H2>SEE ALSO</H2>


<B><A HREF="/manpages/index.html?1+ntpdate">ntpdate</A></B>(1),


<B><A HREF="/manpages/index.html?8+inetd">inetd</A></B>(8)

<A NAME="lbAK">&nbsp;</A>
<H2>COLOPHON</H2>

This page is part of release 3.22 of the Linux
<I>man-pages</I>

project.
A description of the project,
and information about reporting bugs,
can be found at
<A HREF="http://www.kernel.org/doc/man-pages/.">http://www.kernel.org/doc/man-pages/.</A>
<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">NAME</A><DD>
<DT><A HREF="#lbAC">SYNOPSIS</A><DD>
<DT><A HREF="#lbAD">DESCRIPTION</A><DD>
<DT><A HREF="#lbAE">RETURN VALUE</A><DD>
<DT><A HREF="#lbAF">ERRORS</A><DD>
<DT><A HREF="#lbAG">NOTES</A><DD>
<DT><A HREF="#lbAH">BUGS</A><DD>
<DT><A HREF="#lbAI">EXAMPLE</A><DD>
<DT><A HREF="#lbAJ">SEE ALSO</A><DD>
<DT><A HREF="#lbAK">COLOPHON</A><DD>
</DL>
<HR>
This document was created by
<A HREF="/manpages/index.html">man2html</A>,
using the manual pages.<BR>
Time: 05:33:38 GMT, December 24, 2015
</div></div>
</body>
</HTML>
