<!DOCTYPE html>

<HTML><head><TITLE>Manpage of docs::api::Apache2::SubRequest</TITLE>
<meta charset="utf-8">
<link rel="stylesheet" href="/css/main.css" type="text/css">
</head>
<body>
 <header class="site-header">
 <div class="wrap"> <div class="site-title"><a href="/manpages/index.html">linux manpages</a></div>
 <div class="site-description">{"type":"programming"}</div>
 </div>
 </header>
 <div class="page-content"><div class="wrap">
<H1>docs::api::Apache2::SubRequest</H1>
Section: User Contributed Perl Documentation (3)<BR>Updated: 2007-11-12<BR><A HREF="#index">Index</A>
<A HREF="/manpages/index.html">Return to Main Contents</A><HR>






<A NAME="lbAB">&nbsp;</A>
<H2>NAME</H2>

Apache2::SubRequest - Perl API for Apache subrequests
<A NAME="lbAC">&nbsp;</A>
<H2>Synopsis</H2>

<A NAME="ixAAC"></A>


<PRE>
  use Apache2::SubRequest ();
  
  # run internal redirects at once
  $r-&gt;internal_redirect($new_uri);
  $r-&gt;internal_redirect_handler($new_uri);
  
  # create internal redirect objects
  $subr = $r-&gt;lookup_uri(&quot;/foo&quot;);
  $subr = $r-&gt;lookup_method_uri(&quot;GET&quot;, &quot;/tmp/bar&quot;)
  $subr = $r-&gt;lookup_file(&quot;/tmp/bar&quot;);
  # optionally manipulate the output through main request filters
  $subr = $r-&gt;lookup_uri(&quot;/foo&quot;, $r-&gt;output_filters);
  # now run them
  my $rc = $subr-&gt;run;

</PRE>


<A NAME="lbAD">&nbsp;</A>
<H2>Description</H2>

<A NAME="ixAAD"></A>
<TT>&quot;Apache2::SubRequest&quot;</TT> contains <FONT SIZE="-1">API</FONT> for creating and running of Apache
sub-requests.
<P>

<TT>&quot;Apache2::SubRequest&quot;</TT> is a sub-class of <TT>&quot;Apache2::RequestRec
object&quot;</TT>.
<A NAME="lbAE">&nbsp;</A>
<H2>API</H2>

<A NAME="ixAAE"></A>
<TT>&quot;Apache2::SubRequest&quot;</TT> provides the following functions and/or methods:
<A NAME="lbAF">&nbsp;</A>
<H3>DESTROY</H3>



<A NAME="ixAAF"></A>
Free the memory associated with a sub request:
<P>



<PRE>
  undef $subr; # but normally don't do that

</PRE>


<DL COMPACT>
<DT>obj: $subr ( Apache2::SubRequest object )<DD>


<A NAME="ixAAG"></A>
The sub request to finish
<DT>ret: no return value<DD>
<A NAME="ixAAH"></A>

<DT>since: 2.0.00<DD>
<A NAME="ixAAI"></A>

</DL>
<P>

<TT>&quot;DESTROY&quot;</TT> is called automatically when <TT>$subr</TT> goes out of scope.
<P>

If you want to free the memory earlier than that (for example if you
run several subrequests), you can <TT>&quot;undef&quot;</TT> the object as:
<P>



<PRE>
  undef $subr;

</PRE>


<P>

but never call <TT>&quot;DESTROY&quot;</TT> explicitly, since it'll result in
<TT>&quot;ap_destroy_sub_req&quot;</TT> being called more than once, resulting in
multiple brain injuries and certain hair loss.
<A NAME="lbAG">&nbsp;</A>
<H3>internal_redirect</H3>



<A NAME="ixAAJ"></A>
Redirect the current request to some other uri internally
<P>



<PRE>
  $r-&gt;internal_redirect($new_uri);

</PRE>


<DL COMPACT>
<DT>obj: $r ( Apache2::RequestRec object )<DD>


<A NAME="ixAAK"></A>
The current request
<DT>arg1: $new_uri ( string )<DD>


<A NAME="ixAAL"></A>
The <FONT SIZE="-1">URI</FONT> to replace the current request with
<DT>ret: no return value<DD>
<A NAME="ixAAM"></A>

<DT>since: 2.0.00<DD>
<A NAME="ixAAN"></A>

</DL>
<P>

In case that you want some other request to be served as the top-level
request instead of what the client requested directly, call this
method from a handler, and then immediately return <TT>&quot;Apache2::Const::OK&quot;</TT>. The
client will be unaware the a different request was served to her
behind the scenes.
<A NAME="lbAH">&nbsp;</A>
<H3>internal_redirect_handler</H3>



<A NAME="ixAAO"></A>
Identical to <TT>&quot;internal_redirect&quot;</TT>, plus
automatically sets
<TT>&quot;$r-&gt;content_type&quot;</TT>
is of the sub-request to be the same as of the main request, if
<TT>&quot;$r-&gt;handler&quot;</TT> is
true.
<P>



<PRE>
  $r-&gt;internal_redirect_handler($new_uri);

</PRE>


<DL COMPACT>
<DT>obj: $r ( Apache2::RequestRec object )<DD>


<A NAME="ixAAP"></A>
The current request
<DT>arg1: $new_uri ( string )<DD>


<A NAME="ixAAQ"></A>
The <FONT SIZE="-1">URI</FONT> to replace the current request with.
<DT>ret: no return value<DD>
<A NAME="ixAAR"></A>

<DT>since: 2.0.00<DD>
<A NAME="ixAAS"></A>

</DL>
<P>

This function is designed for things like actions or <FONT SIZE="-1">CGI</FONT> scripts, when
using <TT>&quot;AddHandler&quot;</TT>, and you want to preserve the content type across
an internal redirect.
<A NAME="lbAI">&nbsp;</A>
<H3>lookup_file</H3>



<A NAME="ixAAT"></A>
Create a subrequest for the given file.  This sub request can be
inspected to find information about the requested file
<P>



<PRE>
  $ret = $r-&gt;lookup_file($new_file);
  $ret = $r-&gt;lookup_file($new_file, $next_filter);

</PRE>


<DL COMPACT>
<DT>obj: $r ( Apache2::RequestRec object )<DD>


<A NAME="ixAAU"></A>
The current request
<DT>arg1: $new_file ( string )<DD>


<A NAME="ixAAV"></A>
The file to lookup
<DT>opt arg2: $next_filter ( Apache2::Filter )<DD>


<A NAME="ixAAW"></A>
See <TT>&quot;$r-&gt;lookup_uri&quot;</TT> for details.
<DT>ret: $ret ( Apache2::SubRequest object )<DD>


<A NAME="ixAAX"></A>
The sub request record.
<DT>since: 2.0.00<DD>
<A NAME="ixAAY"></A>
</DL>
<P>

See <TT>&quot;$r-&gt;lookup_uri&quot;</TT> for further discussion.
<A NAME="lbAJ">&nbsp;</A>
<H3>lookup_method_uri</H3>



<A NAME="ixAAZ"></A>
Create a sub request for the given <FONT SIZE="-1">URI</FONT> using a specific method.  This
sub request can be inspected to find information about the requested
<FONT SIZE="-1">URI</FONT>
<P>



<PRE>
  $ret = $r-&gt;lookup_method_uri($method, $new_uri);
  $ret = $r-&gt;lookup_method_uri($method, $new_uri, $next_filter);

</PRE>


<DL COMPACT>
<DT>obj: $r ( Apache2::RequestRec object )<DD>


<A NAME="ixABA"></A>
The current request
<DT>arg1: $method ( string )<DD>


<A NAME="ixABB"></A>
The method to use in the new sub request (e.g. <TT>&quot;GET&quot;</TT>)
<DT>arg2: $new_uri ( string )<DD>


<A NAME="ixABC"></A>
The <FONT SIZE="-1">URI</FONT> to lookup
<DT>opt arg3: $next_filter ( Apache2::Filter object )<DD>


<A NAME="ixABD"></A>
See <TT>&quot;$r-&gt;lookup_uri&quot;</TT> for details.
<DT>ret: $ret ( Apache2::SubRequest object )<DD>


<A NAME="ixABE"></A>
The sub request record.
<DT>since: 2.0.00<DD>
<A NAME="ixABF"></A>
</DL>
<P>

See <TT>&quot;$r-&gt;lookup_uri&quot;</TT> for further discussion.
<A NAME="lbAK">&nbsp;</A>
<H3>lookup_uri</H3>



<A NAME="ixABG"></A>
Create a sub request from the given <FONT SIZE="-1">URI</FONT>.  This sub request can be
inspected to find information about the requested <FONT SIZE="-1">URI</FONT>.
<P>



<PRE>
  $ret = $r-&gt;lookup_uri($new_uri);
  $ret = $r-&gt;lookup_uri($new_uri, $next_filter);

</PRE>


<DL COMPACT>
<DT>obj: $r ( Apache2::RequestRec object )<DD>


<A NAME="ixABH"></A>
The current request
<DT>arg1: $new_uri ( string )<DD>


<A NAME="ixABI"></A>
The <FONT SIZE="-1">URI</FONT> to lookup
<DT>opt arg2: $next_filter ( Apache2::Filter object )<DD>


<A NAME="ixABJ"></A>
The first filter the subrequest should pass the data through.  If not
specified it defaults to the first connection output filter for the
main request
<TT>&quot;$r-&gt;proto_output_filters&quot;</TT>. So
if the subrequest sends any output it will be filtered only once. If
for example you desire to apply the main request's output filters to
the sub-request output as well pass
<TT>&quot;$r-&gt;output_filters&quot;</TT>
as an argument.
<DT>ret: $ret ( Apache2::SubRequest object )<DD>


<A NAME="ixABK"></A>
The sub request record
<DT>since: 2.0.00<DD>
<A NAME="ixABL"></A>
</DL>
<P>

Here is an example of a simple subrequest which serves uri
<I>/new_uri</I>:
<P>



<PRE>
  sub handler {
      my $r = shift;
  
      my $subr = $r-&gt;lookup_uri(&quot;/new_uri&quot;);
      $sub-&gt;run;
  
      return Apache2::Const::OK;
  }

</PRE>


<P>

If let's say you have three request output filters registered to run
for the main request:
<P>



<PRE>
  PerlOutputFilterHandler MyApache2::SubReqExample::filterA
  PerlOutputFilterHandler MyApache2::SubReqExample::filterB
  PerlOutputFilterHandler MyApache2::SubReqExample::filterC

</PRE>


<P>

and you wish to run them all, the code needs to become:
<P>



<PRE>
      my $subr = $r-&gt;lookup_uri(&quot;/new_uri&quot;, $r-&gt;output_filters);

</PRE>


<P>

and if you wish to run them all, but the first one (<TT>&quot;filterA&quot;</TT>), the
code needs to be adjusted to be:
<P>



<PRE>
      my $subr = $r-&gt;lookup_uri(&quot;/new_uri&quot;, $r-&gt;output_filters-&gt;next);

</PRE>


<A NAME="lbAL">&nbsp;</A>
<H3>run</H3>



<A NAME="ixABM"></A>
Run a sub-request
<P>



<PRE>
  $rc = $subr-&gt;run();

</PRE>


<DL COMPACT>
<DT>obj: $subr ( Apache2::RequestRec object )<DD>


<A NAME="ixABN"></A>
The sub-request (e.g. returned by <TT>&quot;lookup_uri&quot;</TT>)
<DT>ret: $rc ( integer )<DD>


<A NAME="ixABO"></A>
The return code of the handler (<TT>&quot;Apache2::Const::OK&quot;</TT>, <TT>&quot;Apache2::Const::DECLINED&quot;</TT>,
etc.)
<DT>since: 2.0.00<DD>
<A NAME="ixABP"></A>
</DL>
<A NAME="lbAM">&nbsp;</A>
<H2>Unsupported API</H2>

<A NAME="ixABQ"></A>
<TT>&quot;Apache2::SubRequest&quot;</TT> also provides auto-generated Perl interface for
a few other methods which aren't tested at the moment and therefore
their <FONT SIZE="-1">API</FONT> is a subject to change. These methods will be finalized
later as a need arises. If you want to rely on any of the following
methods please contact the the mod_perl development mailing
list so we can help each other take the steps necessary
to shift the method to an officially supported <FONT SIZE="-1">API</FONT>.
<A NAME="lbAN">&nbsp;</A>
<H3>internal_fast_redirect</H3>



<A NAME="ixABR"></A>
<FONT SIZE="-1">META:</FONT> Autogenerated - needs to be reviewed/completed
<P>

Redirect the current request to a sub_req, merging the pools
<P>



<PRE>
  $r-&gt;internal_fast_redirect($sub_req);

</PRE>


<DL COMPACT>
<DT>obj: $r ( Apache2::RequestRec object )<DD>


<A NAME="ixABS"></A>
The current request
<DT>arg1: $sub_req ( string )<DD>


<A NAME="ixABT"></A>
A subrequest created from this request
<DT>ret: no return value<DD>
<A NAME="ixABU"></A>

<DT>since: 2.0.00<DD>
<A NAME="ixABV"></A>

</DL>
<P>

<FONT SIZE="-1">META:</FONT> httpd-2.0/modules/http/http_request.c declares this function as:
<P>



<PRE>
  /* XXX: Is this function is so bogus and fragile that we deep-6 it? */

</PRE>


<P>

do we really want to expose it to mod_perl users?
<A NAME="lbAO">&nbsp;</A>
<H3>lookup_dirent</H3>



<A NAME="ixABW"></A>
<FONT SIZE="-1">META:</FONT> Autogenerated - needs to be reviewed/completed
<P>

Create a sub request for the given apr_dir_read result.  This sub request
can be inspected to find information about the requested file
<P>



<PRE>
  $lr = $r-&gt;lookup_dirent($finfo);
  $lr = $r-&gt;lookup_dirent($finfo, $subtype);
  $lr = $r-&gt;lookup_dirent($finfo, $subtype, $next_filter);

</PRE>


<DL COMPACT>
<DT>obj: $r ( Apache2::RequestRec object )<DD>


<A NAME="ixABX"></A>
The current request
<DT>arg1: $finfo ( APR::Finfo object )<DD>


<A NAME="ixABY"></A>
The apr_dir_read result to lookup
<DT>arg2: $subtype ( integer )<DD>


<A NAME="ixABZ"></A>
What type of subrequest to perform, one of;


<P>




<PRE>
  Apache2::SUBREQ_NO_ARGS     ignore r-&gt;args and r-&gt;path_info
  Apache2::SUBREQ_MERGE_ARGS  merge  r-&gt;args and r-&gt;path_info

</PRE>


<DT>arg3: $next_filter ( integer )<DD>


<A NAME="ixACA"></A>
The first filter the sub_request should use.  If this is
<FONT SIZE="-1">NULL</FONT>, it defaults to the first filter for the main request
<DT>ret: $lr ( Apache2::RequestRec object )<DD>


<A NAME="ixACB"></A>
The new request record
<DT>since: 2.0.00<DD>
<A NAME="ixACC"></A>
</DL>
<P>

<FONT SIZE="-1">META:</FONT> where do we take the apr_dir_read result from?
<A NAME="lbAP">&nbsp;</A>
<H2>See Also</H2>

<A NAME="ixACD"></A>
mod_perl 2.0 documentation.
<A NAME="lbAQ">&nbsp;</A>
<H2>Copyright</H2>

<A NAME="ixACE"></A>
mod_perl 2.0 and its core modules are copyrighted under
The Apache Software License, Version 2.0.
<A NAME="lbAR">&nbsp;</A>
<H2>Authors</H2>

<A NAME="ixACF"></A>
The mod_perl development team and numerous
contributors.
<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">NAME</A><DD>
<DT><A HREF="#lbAC">Synopsis</A><DD>
<DT><A HREF="#lbAD">Description</A><DD>
<DT><A HREF="#lbAE">API</A><DD>
<DL>
<DT><A HREF="#lbAF">DESTROY</A><DD>
<DT><A HREF="#lbAG">internal_redirect</A><DD>
<DT><A HREF="#lbAH">internal_redirect_handler</A><DD>
<DT><A HREF="#lbAI">lookup_file</A><DD>
<DT><A HREF="#lbAJ">lookup_method_uri</A><DD>
<DT><A HREF="#lbAK">lookup_uri</A><DD>
<DT><A HREF="#lbAL">run</A><DD>
</DL>
<DT><A HREF="#lbAM">Unsupported API</A><DD>
<DL>
<DT><A HREF="#lbAN">internal_fast_redirect</A><DD>
<DT><A HREF="#lbAO">lookup_dirent</A><DD>
</DL>
<DT><A HREF="#lbAP">See Also</A><DD>
<DT><A HREF="#lbAQ">Copyright</A><DD>
<DT><A HREF="#lbAR">Authors</A><DD>
</DL>
<HR>
This document was created by
<A HREF="/manpages/index.html">man2html</A>,
using the manual pages.<BR>
Time: 05:33:11 GMT, December 24, 2015
</div></div>
</body>
</HTML>
