<!DOCTYPE html>

<HTML><head><TITLE>Manpage of docs::api::Apache2::Log</TITLE>
<meta charset="utf-8">
<link rel="stylesheet" href="/css/main.css" type="text/css">
</head>
<body>
 <header class="site-header">
 <div class="wrap"> <div class="site-title"><a href="/manpages/index.html">linux manpages</a></div>
 <div class="site-description">{"type":"programming"}</div>
 </div>
 </header>
 <div class="page-content">
<H1>docs::api::Apache2::Log</H1>
Section: User Contributed Perl Documentation (3)<BR>Updated: 2007-11-12<BR><A HREF="#index">Index</A>
<A HREF="/manpages/index.html">Return to Main Contents</A><HR>






<A NAME="lbAB">&nbsp;</A>
<H2>NAME</H2>

Apache2::Log - Perl API for Apache Logging Methods
<A NAME="lbAC">&nbsp;</A>
<H2>Synopsis</H2>

<A NAME="ixAAC"></A>


<PRE>
  # in startup.pl
  #--------------
  use Apache2::Log;
  
  use Apache2::Const -compile =&gt; qw(OK :log);
  use APR::Const    -compile =&gt; qw(:error SUCCESS);
  
  my $s = Apache2::ServerUtil-&gt;server;
  
  $s-&gt;log_error(&quot;server: log_error&quot;);
  $s-&gt;log_serror(__FILE__, __LINE__, Apache2::Const::LOG_ERR,
                 APR::Const::SUCCESS, &quot;log_serror logging at err level&quot;);
  $s-&gt;log_serror(Apache2::Log::LOG_MARK, Apache2::Const::LOG_DEBUG,
                 APR::Const::ENOTIME, &quot;debug print&quot;);
  Apache2::ServerRec-&gt;log_error(&quot;routine warning&quot;);
  
  Apache2::ServerRec::warn(&quot;routine warning&quot;);

  # in a handler
  #-------------
  package Foo;
  
  use strict;
  use warnings FATAL =&gt; 'all';
  
  use Apache2::Log;
  
  use Apache2::Const -compile =&gt; qw(OK :log);
  use APR::Const    -compile =&gt; qw(:error SUCCESS);
  
  sub handler {
      my $r = shift;
      $r-&gt;log_error(&quot;request: log_error&quot;);
  
      my $rlog = $r-&gt;log;
      for my $level qw(emerg alert crit error warn notice info debug) {
          no strict 'refs';
          $rlog-&gt;$level($package, &quot;request: $level log level&quot;);
      }
  
      # can use server methods as well
      my $s = $r-&gt;server;
      $s-&gt;log_error(&quot;server: log_error&quot;);
  
      $r-&gt;log_rerror(Apache2::Log::LOG_MARK, Apache2::Const::LOG_DEBUG,
                     APR::Const::ENOTIME, &quot;in debug&quot;);
  
      $s-&gt;log_serror(Apache2::Log::LOG_MARK, Apache2::Const::LOG_INFO,
                     APR::Const::SUCCESS, &quot;server info&quot;);
  
      $s-&gt;log_serror(Apache2::Log::LOG_MARK, Apache2::Const::LOG_ERR,
                     APR::Const::ENOTIME, &quot;fatal error&quot;);
  
      $r-&gt;log_reason(&quot;fatal error&quot;);
      $r-&gt;warn('routine request warning');
      $s-&gt;warn('routine server warning');
  
      return Apache2::Const::OK;
  }
  1;

  # in a registry script
  # httpd.conf: PerlOptions +GlobalRequest
  use Apache2::ServerRec qw(warn); # override warn locally
  print &quot;Content-type: text/plain\n\n&quot;;
  warn &quot;my warning&quot;;

</PRE>


<A NAME="lbAD">&nbsp;</A>
<H2>Description</H2>

<A NAME="ixAAD"></A>
<TT>&quot;Apache2::Log&quot;</TT> provides the Perl <FONT SIZE="-1">API</FONT> for Apache logging methods.
<P>

Depending on the the current <TT>&quot;LogLevel&quot;</TT> setting, only logging with
the same log level or higher will be loaded. For example if the
current <TT>&quot;LogLevel&quot;</TT> is set to <I>warning</I>, only messages with log level
of the level <I>warning</I> or higher (<I>err</I>, <I>crit</I>, <I>elert</I> and
<I>emerg</I>) will be logged. Therefore this:
<P>



<PRE>
  $r-&gt;log_rerror(Apache2::Log::LOG_MARK, Apache2::Const::LOG_WARNING,
                 APR::Const::ENOTIME, &quot;warning!&quot;);

</PRE>


<P>

will log the message, but this one won't:
<P>



<PRE>
  $r-&gt;log_rerror(Apache2::Log::LOG_MARK, Apache2::Const::LOG_INFO,
                 APR::Const::ENOTIME, &quot;just an info&quot;);

</PRE>


<P>

It will be logged only if the server log level is set to <I>info</I> or
<I>debug</I>. <TT>&quot;LogLevel&quot;</TT> is set in the configuration file, but can be
changed using the
<TT>&quot;$s-&gt;loglevel()&quot;</TT>
method.
<P>

The filename and the line number of the caller are logged only if
<TT>&quot;Apache2::Const::LOG_DEBUG&quot;</TT> is used (because that's how Apache 2.0 logging
mechanism works).
<P>

Note: On Win32 Apache attempts to lock all writes to a file whenever
it's opened for append (which is the case with logging functions), as
Unix has this behavior built-in, while Win32 does not. Therefore
<TT>&quot;Apache2::Log&quot;</TT> functions could be slower than Perl's <I>print()</I>/<I>warn()</I>.
<A NAME="lbAE">&nbsp;</A>
<H2>Constants</H2>

<A NAME="ixAAE"></A>
Log level constants can be compiled all at once:
<P>



<PRE>
  use Apache2::Const -compile =&gt; qw(:log);

</PRE>


<P>

or individually:
<P>



<PRE>
  use Apache2::Const -compile =&gt; qw(LOG_DEBUG LOG_INFO);

</PRE>


<A NAME="lbAF">&nbsp;</A>
<H3>LogLevel Constants</H3>

<A NAME="ixAAF"></A>
The following constants (sorted from the most severe level to the
least severe) are used in logging methods to specify the log level at
which the message should be logged:
<P>

<I></I>&quot;Apache2::Const::LOG_EMERG&quot;<I></I>
<A NAME="ixAAG"></A>
<P>

<I></I>&quot;Apache2::Const::LOG_ALERT&quot;<I></I>
<A NAME="ixAAH"></A>
<P>

<I></I>&quot;Apache2::Const::LOG_CRIT&quot;<I></I>
<A NAME="ixAAI"></A>
<P>

<I></I>&quot;Apache2::Const::LOG_ERR&quot;<I></I>
<A NAME="ixAAJ"></A>
<P>

<I></I>&quot;Apache2::Const::LOG_WARNING&quot;<I></I>
<A NAME="ixAAK"></A>
<P>

<I></I>&quot;Apache2::Const::LOG_NOTICE&quot;<I></I>
<A NAME="ixAAL"></A>
<P>

<I></I>&quot;Apache2::Const::LOG_INFO&quot;<I></I>
<A NAME="ixAAM"></A>
<P>

<I></I>&quot;Apache2::Const::LOG_DEBUG&quot;<I></I>
<A NAME="ixAAN"></A>
<A NAME="lbAG">&nbsp;</A>
<H3>Other Constants</H3>

<A NAME="ixAAO"></A>
Make sure to compile the <FONT SIZE="-1">APR</FONT> status constants before using them. For
example to compile <TT>&quot;APR::Const::SUCCESS&quot;</TT> and all the <FONT SIZE="-1">APR</FONT> error status
constants do:
<P>



<PRE>
  use APR::Const    -compile =&gt; qw(:error SUCCESS);

</PRE>


<P>

Here is the rest of the logging related constants:
<P>

<I></I>&quot;Apache2::Const::LOG_LEVELMASK&quot;<I></I>
<A NAME="ixAAP"></A>
<P>

used to mask off the level value, to make sure that the log level's
value is within the proper bits range. e.g.:
<P>



<PRE>
  $loglevel &amp;= LOG_LEVELMASK;

</PRE>


<P>

<I></I>&quot;Apache2::Const::LOG_TOCLIENT&quot;<I></I>
<A NAME="ixAAQ"></A>
<P>

used to give content handlers the option of including the error text
in the <TT>&quot;ErrorDocument&quot;</TT> sent back to the client. When
<TT>&quot;Apache2::Const::LOG_TOCLIENT&quot;</TT> is passed to <TT>&quot;log_rerror()&quot;</TT> the error message
will be saved in the <TT>$r</TT>'s notes table, keyed to the string
<I>``error-notes''</I>, if and only if the severity level of the message is
<TT>&quot;Apache2::Const::LOG_WARNING&quot;</TT> or greater and there are no other
<I>``error-notes''</I> entry already set in the request record's notes
table. Once the <I>``error-notes''</I> entry is set, it is up to the error
handler to determine whether this text should be sent back to the
client.  For example:
<P>



<PRE>
  use Apache2::Const -compile =&gt; qw(:log);
  use APR::Const    -compile =&gt; qw(ENOTIME);
  $r-&gt;log_rerror(Apache2::Log::LOG_MARK,
                 Apache2::Const::LOG_ERR|Apache2::Const::LOG_TOCLIENT,
                 APR::Const::ENOTIME,
                 &quot;request log_rerror&quot;);

</PRE>


<P>

now the log message can be retrieved via:
<P>



<PRE>
  $r-&gt;notes-&gt;get(&quot;error-notes&quot;);

</PRE>


<P>

Remember that client-generated text streams sent back to the client
<B></B><FONT SIZE="-1"><B>MUST</B></FONT><B></B> be escaped to prevent <FONT SIZE="-1">CSS</FONT> attacks.
<P>

<I></I>&quot;Apache2::Const::LOG_STARTUP&quot;<I></I>
<A NAME="ixAAR"></A>
<P>

is useful for startup message where no timestamps, logging level is
wanted. For example:
<P>



<PRE>
  use Apache2::Const -compile =&gt; qw(:log);
  use APR::Const    -compile =&gt; qw(SUCCESS);
  $s-&gt;log_serror(Apache2::Log::LOG_MARK,
                 Apache2::Const::LOG_INFO,
                 APR::Const::SUCCESS,
                 &quot;This log message comes with a header&quot;);

</PRE>


<P>

will print:
<P>



<PRE>
  [Wed May 14 16:47:09 2003] [info] This log message comes with a header

</PRE>


<P>

whereas, when <TT>&quot;Apache2::Const::LOG_STARTUP&quot;</TT> is binary ORed as in:
<P>



<PRE>
  use Apache2::Const -compile =&gt; qw(:log);
  use APR::Const    -compile =&gt; qw(SUCCESS);
  $s-&gt;log_serror(Apache2::Log::LOG_MARK,
                 Apache2::Const::LOG_INFO|Apache2::Const::LOG_STARTUP,
                 APR::Const::SUCCESS,
                 &quot;This log message comes with no header&quot;);

</PRE>


<P>

then the logging will be:
<P>



<PRE>
  This log message comes with no header

</PRE>


<A NAME="lbAH">&nbsp;</A>
<H2>Server Logging Methods</H2>

<A NAME="ixAAS"></A>
<A NAME="lbAI">&nbsp;</A>
<H3>$s-&gt;log</H3>



<A NAME="ixAAT"></A>
get a log handle which can be used to log messages of different
levels.
<P>



<PRE>
  my $slog = $s-&gt;log;

</PRE>


<DL COMPACT>
<DT>obj: $s ( Apache2::ServerRec object )<DD>


<A NAME="ixAAU"></A>

<DT>ret: $slog ( Apache2::Log::Server object )<DD>


<A NAME="ixAAV"></A>

<TT>&quot;Apache2::Log::Server&quot;</TT> object to be used with LogLevel
methods.
<DT>since: 2.0.00<DD>
<A NAME="ixAAW"></A>
</DL>
<A NAME="lbAJ">&nbsp;</A>
<H3>$s-&gt;log_error</H3>



<A NAME="ixAAX"></A>
just logs the supplied message to <I>error_log</I>
<P>



<PRE>
  $s-&gt;log_error(@message);

</PRE>


<DL COMPACT>
<DT>obj: $s ( Apache2::ServerRec object )<DD>


<A NAME="ixAAY"></A>

<DT>arg1: @message ( strings <FONT SIZE="-1">ARRAY</FONT> )<DD>


<A NAME="ixAAZ"></A>

what to log
<DT>ret: no return value<DD>
<A NAME="ixABA"></A>

<DT>since: 2.0.00<DD>
<A NAME="ixABB"></A>

</DL>
<P>

For example:
<P>



<PRE>
  $s-&gt;log_error(&quot;running low on memory&quot;);

</PRE>


<A NAME="lbAK">&nbsp;</A>
<H3>$s-&gt;log_serror</H3>



<A NAME="ixABC"></A>
This function provides a fine control of when the message is logged,
gives an access to built-in status codes.
<P>



<PRE>
  $s-&gt;log_serror($file, $line, $level, $status, @message);

</PRE>


<DL COMPACT>
<DT>obj: $s ( Apache2::ServerRec object )<DD>


<A NAME="ixABD"></A>

<DT>arg1: $file ( string )<DD>


<A NAME="ixABE"></A>

The file in which this function is called
<DT>arg2: $line ( number )<DD>


<A NAME="ixABF"></A>
The line number on which this function is called
<DT>arg3: $level ( Apache2::LOG_* constant )<DD>


<A NAME="ixABG"></A>
The level of this error message
<DT>arg4: $status ( APR::Const status constant )<DD>


<A NAME="ixABH"></A>
The status code from the last command (similar to $! in perl), usually
<TT>&quot;APR::Const constant&quot;</TT> or coming from an
exception object.
<DT>arg5: @message ( strings <FONT SIZE="-1">ARRAY</FONT> )<DD>


<A NAME="ixABI"></A>
The log message(s)
<DT>ret: no return value<DD>
<A NAME="ixABJ"></A>

<DT>since: 2.0.00<DD>
<A NAME="ixABK"></A>

</DL>
<P>

For example:
<P>



<PRE>
  use Apache2::Const -compile =&gt; qw(:log);
  use APR::Const    -compile =&gt; qw(ENOTIME SUCCESS);
  $s-&gt;log_serror(Apache2::Log::LOG_MARK, Apache2::Const::LOG_ERR,
                 APR::Const::SUCCESS, &quot;log_serror logging at err level&quot;);
  
  $s-&gt;log_serror(Apache2::Log::LOG_MARK, Apache2::Const::LOG_DEBUG,
                 APR::Const::ENOTIME, &quot;debug print&quot;);

</PRE>


<A NAME="lbAL">&nbsp;</A>
<H3>$s-&gt;warn</H3>



<A NAME="ixABL"></A>


<PRE>
  $s-&gt;warn(@warnings);

</PRE>


<P>

is the same as:
<P>



<PRE>
  $s-&gt;log_serror(Apache2::Log::LOG_MARK, Apache2::Const::LOG_WARNING,
                 APR::Const::SUCCESS, @warnings)

</PRE>


<DL COMPACT>
<DT>obj: $s ( Apache2::ServerRec object )<DD>


<A NAME="ixABM"></A>

<DT>arg1: @warnings ( strings <FONT SIZE="-1">ARRAY</FONT> )<DD>


<A NAME="ixABN"></A>

array of warning strings
<DT>ret: no return value<DD>
<A NAME="ixABO"></A>

<DT>since: 2.0.00<DD>
<A NAME="ixABP"></A>

</DL>
<P>

For example:
<P>



<PRE>
  $s-&gt;warn('routine server warning');

</PRE>


<A NAME="lbAM">&nbsp;</A>
<H2>Request Logging Methods</H2>

<A NAME="ixABQ"></A>
<A NAME="lbAN">&nbsp;</A>
<H3>$r-&gt;log</H3>



<A NAME="ixABR"></A>
get a log handle which can be used to log messages of different
levels.
<P>



<PRE>
  $rlog = $r-&gt;log;

</PRE>


<DL COMPACT>
<DT>obj: $r ( Apache2::RequestRec object )<DD>


<A NAME="ixABS"></A>

<DT>ret: $rlog ( Apache2::Log::Request object )<DD>


<A NAME="ixABT"></A>

<TT>&quot;Apache2::Log::Request&quot;</TT> object to be used with LogLevel
methods.
<DT>since: 2.0.00<DD>
<A NAME="ixABU"></A>
</DL>
<A NAME="lbAO">&nbsp;</A>
<H3>$r-&gt;log_error</H3>



<A NAME="ixABV"></A>
just logs the supplied message (similar to
<TT>&quot;$s-&gt;log_error&quot;</TT> ).
<P>



<PRE>
  $r-&gt;log_error(@message);

</PRE>


<DL COMPACT>
<DT>obj: $r ( Apache2::RequestRec object )<DD>


<A NAME="ixABW"></A>

<DT>arg1: @message ( strings <FONT SIZE="-1">ARRAY</FONT> )<DD>


<A NAME="ixABX"></A>

what to log
<DT>ret: no return value<DD>
<A NAME="ixABY"></A>

<DT>since: 2.0.00<DD>
<A NAME="ixABZ"></A>

</DL>
<P>

For example:
<P>



<PRE>
  $r-&gt;log_error(&quot;the request is about to end&quot;);

</PRE>


<A NAME="lbAP">&nbsp;</A>
<H3>$r-&gt;log_reason</H3>



<A NAME="ixACA"></A>
This function provides a convenient way to log errors in a
preformatted way:
<P>



<PRE>
  $r-&gt;log_reason($message);
  $r-&gt;log_reason($message, $filename);

</PRE>


<DL COMPACT>
<DT>obj: $r ( Apache2::RequestRec object )<DD>


<A NAME="ixACB"></A>

<DT>arg1: $message ( string )<DD>


<A NAME="ixACC"></A>

the message to log
<DT>opt arg2: $filename ( string )<DD>


<A NAME="ixACD"></A>
where to report the error as coming from (e.g. <TT>&quot;__FILE__&quot;</TT>)
<DT>ret: no return value<DD>
<A NAME="ixACE"></A>

<DT>since: 2.0.00<DD>
<A NAME="ixACF"></A>

</DL>
<P>

For example:
<P>



<PRE>
  $r-&gt;log_reason(&quot;There is no enough data&quot;);

</PRE>


<P>

will generate a log entry similar to the following:
<P>



<PRE>
  [Fri Sep 24 11:58:36 2004] [error] access to /someuri
  failed for 127.0.0.1, reason: There is no enough data.

</PRE>


<A NAME="lbAQ">&nbsp;</A>
<H3>$r-&gt;log_rerror</H3>



<A NAME="ixACG"></A>
This function provides a fine control of when the message is logged,
gives an access to built-in status codes.
<P>



<PRE>
  $r-&gt;log_rerror($file, $line, $level, $status, @message);

</PRE>


<P>

arguments are identical to
<TT>&quot;$s-&gt;log_serror&quot;</TT>.
<DL COMPACT>
<DT>since: 2.0.00<DD>
<A NAME="ixACH"></A>
</DL>
<P>

For example:
<P>



<PRE>
  use Apache2::Const -compile =&gt; qw(:log);
  use APR::Const    -compile =&gt; qw(ENOTIME SUCCESS);
  $r-&gt;log_rerror(Apache2::Log::LOG_MARK, Apache2::Const::LOG_ERR,
                 APR::Const::SUCCESS, &quot;log_rerror logging at err level&quot;);
  
  $r-&gt;log_rerror(Apache2::Log::LOG_MARK, Apache2::Const::LOG_DEBUG,
                 APR::Const::ENOTIME, &quot;debug print&quot;);

</PRE>


<A NAME="lbAR">&nbsp;</A>
<H3>$r-&gt;warn</H3>



<A NAME="ixACI"></A>


<PRE>
  $r-&gt;warn(@warnings);

</PRE>


<P>

is the same as:
<P>



<PRE>
  $r-&gt;log_rerror(Apache2::Log::LOG_MARK, Apache2::Const::LOG_WARNING,
                 APR::Const::SUCCESS, @warnings)

</PRE>


<DL COMPACT>
<DT>obj: $r ( Apache2::RequestRec object )<DD>


<A NAME="ixACJ"></A>

<DT>arg1: @warnings ( strings <FONT SIZE="-1">ARRAY</FONT> )<DD>


<A NAME="ixACK"></A>

array of warning strings
<DT>ret: no return value<DD>
<A NAME="ixACL"></A>

<DT>since: 2.0.00<DD>
<A NAME="ixACM"></A>

</DL>
<P>

For example:
<P>



<PRE>
  $r-&gt;warn('routine server warning');

</PRE>


<A NAME="lbAS">&nbsp;</A>
<H2>Other Logging Methods</H2>

<A NAME="ixACN"></A>
<A NAME="lbAT">&nbsp;</A>
<H3>LogLevel Methods</H3>

<A NAME="ixACO"></A>
after getting the log handle with <TT>&quot;$s-&gt;log&quot;</TT> or
<TT>&quot;$r-&gt;log&quot;</TT>, use one of the following methods
(corresponding to the <TT>&quot;LogLevel&quot;</TT> levels):
<P>



<PRE>
  emerg(), alert(), crit(), error(), warn(), notice(), info(), debug()

</PRE>


<P>

to control when messages should be logged:
<P>



<PRE>
  $s-&gt;log-&gt;emerg(@message);
  $r-&gt;log-&gt;emerg(@message);

</PRE>


<DL COMPACT>
<DT>obj: $slog ( server or request log handle )<DD>


<A NAME="ixACP"></A>

<DT>arg1: @message ( strings <FONT SIZE="-1">ARRAY</FONT> )<DD>


<A NAME="ixACQ"></A>
<DT>ret: no return value<DD>
<A NAME="ixACR"></A>
<DT>since: 2.0.00<DD>
<A NAME="ixACS"></A>

</DL>
<P>

For example if the <TT>&quot;LogLevel&quot;</TT> is <TT>&quot;error&quot;</TT> and the following code is
executed:
<P>



<PRE>
  my $slog = $s-&gt;log;
  $slog-&gt;debug(&quot;just &quot;, &quot;some debug info&quot;);
  $slog-&gt;warn(@warnings);
  $slog-&gt;crit(&quot;dying&quot;);

</PRE>


<P>

only the last command's logging will be performed. This is because
<I>warn</I>, <I>debug</I> and other logging command which are listed right to
<I>error</I> will be disabled.
<A NAME="lbAU">&nbsp;</A>
<H3>alert</H3>



<A NAME="ixACT"></A>
See LogLevel Methods.
<A NAME="lbAV">&nbsp;</A>
<H3>crit</H3>



<A NAME="ixACU"></A>
See LogLevel Methods.
<A NAME="lbAW">&nbsp;</A>
<H3>debug</H3>



<A NAME="ixACV"></A>
See LogLevel Methods.
<A NAME="lbAX">&nbsp;</A>
<H3>emerg</H3>



<A NAME="ixACW"></A>
See LogLevel Methods.
<A NAME="lbAY">&nbsp;</A>
<H3>error</H3>



<A NAME="ixACX"></A>
See LogLevel Methods.
<A NAME="lbAZ">&nbsp;</A>
<H3>info</H3>



<A NAME="ixACY"></A>
See LogLevel Methods.
<A NAME="lbBA">&nbsp;</A>
<H3>notice</H3>



<A NAME="ixACZ"></A>
See LogLevel Methods.
<P>

Though Apache treats <TT>&quot;notice()&quot;</TT> calls as special. The message is
always logged regardless the value of <TT>&quot;ErrorLog&quot;</TT>, unless the error
log is set to use syslog. (For details see httpd-2.0/server/log.c.)
<A NAME="lbBB">&nbsp;</A>
<H3>warn</H3>



<A NAME="ixADA"></A>
See LogLevel Methods.
<A NAME="lbBC">&nbsp;</A>
<H2>General Functions</H2>

<A NAME="ixADB"></A>
<A NAME="lbBD">&nbsp;</A>
<H3>LOG_MARK</H3>



<A NAME="ixADC"></A>
Though looking like a constant, this is a function, which returns a
list of two items: <TT>&quot;(__FILE__, __LINE__)&quot;</TT>, i.e. the file and the line
where the function was called from.
<P>



<PRE>
  my ($file, $line) = Apache2::Log::LOG_MARK();

</PRE>


<DL COMPACT>
<DT>ret1: $file ( string )<DD>


<A NAME="ixADD"></A>

<DT>ret2: $line ( number )<DD>


<A NAME="ixADE"></A>
<DT>since: 2.0.00<DD>
<A NAME="ixADF"></A>

</DL>
<P>

It's mostly useful to be passed as the first argument to those logging
methods, expecting the filename and the line number as the first
arguments (e.g., <TT>&quot;$s-&gt;log_serror&quot;</TT> and
<TT>&quot;$r-&gt;log_rerror&quot;</TT> ).
<A NAME="lbBE">&nbsp;</A>
<H2>Virtual Hosts</H2>

<A NAME="ixADG"></A>
Code running from within a virtual host needs to be able to log into
its <TT>&quot;ErrorLog&quot;</TT> file, if different from the main log. Calling any of
the logging methods on the <TT>$r</TT> and <TT>$s</TT> objects will do the logging
correctly.
<P>

If the core <TT>&quot;warn()&quot;</TT> is called, it'll be always logged to the main
log file. Here is how to make it log into the vhost <I>error_log</I> file.
Let's say that we start with the following code:
<P>



<PRE>
  warn &quot;the code is smoking&quot;;

</PRE>


<DL COMPACT>
<DT>1.<DD>
First, we need to use mod_perl's logging function, instead of
<TT>&quot;CORE::warn&quot;</TT>


<P>


Either replace <TT>&quot;warn&quot;</TT> with <TT>&quot;Apache2::ServerRec::warn&quot;</TT>:


<P>




<PRE>
  use Apache2::Log ();
  Apache2::ServerRec::warn(&quot;the code is smoking&quot;);

</PRE>




<P>


or import it into your code:


<P>




<PRE>
  use Apache2::ServerRec qw(warn); # override warn locally
  warn &quot;the code is smoking&quot;;

</PRE>




<P>


or override <TT>&quot;CORE::warn&quot;</TT>:


<P>




<PRE>
  use Apache2::Log ();
  *CORE::GLOBAL::warn = \&amp;Apache2::ServerRec::warn;
  warn &quot;the code is smoking&quot;;

</PRE>




<P>


Avoid using the latter suggestion, since it'll affect all the code
running on the server, which may break things. Of course you can
localize that as well:


<P>




<PRE>
  use Apache2::Log ();
  local *CORE::GLOBAL::warn = \&amp;Apache2::ServerRec::warn;
  warn &quot;the code is smoking&quot;;

</PRE>




<P>


Chances are that you need to make the internal Perl warnings go into
the vhost's <I>error_log</I> file as well. Here is how to do that:


<P>




<PRE>
  use Apache2::Log ();
  local $SIG{__WARN__} = \&amp;Apache2::ServerRec::warn;
  eval q[my $x = &quot;aaa&quot; + 1;]; # this issues a warning

</PRE>




<P>


Notice that it'll override any previous setting you may have had,
disabling modules like <TT>&quot;CGI::Carp&quot;</TT> which also use <TT>$SIG{__WARN__}</TT>
<DT>2.<DD>
Next we need to figure out how to get hold of the vhost's server
object.


<P>


Inside <FONT SIZE="-1">HTTP</FONT> request handlers this is possible via
<TT>&quot;Apache2-&gt;request&quot;</TT>.
Which requires either <TT>&quot;PerlOptions
+GlobalRequest&quot;</TT>
setting or can be also done at runtime if <TT>$r</TT> is available:


<P>




<PRE>
  use Apache2::RequestUtil ();
  sub handler {
      my $r = shift;
      Apache2::RequestUtil-&gt;request($r);
      ...

</PRE>




<P>


Outside <FONT SIZE="-1">HTTP</FONT> handlers at the moment it is not possible, to get hold of
the vhost's <I>error_log</I> file. This shouldn't be a problem for the
code that runs only under mod_perl, since the always available <TT>$s</TT>
object can invoke a plethora of methods supplied by
<TT>&quot;Apache2::Log&quot;</TT>. This is only a problem for modules, which are supposed
to run outside mod_perl as well.


<P>


<FONT SIZE="-1">META:</FONT> To solve this we think to introduce 'PerlOptions +GlobalServer',
a big brother for 'PerlOptions +GlobalRequest', which will be set in
modperl_hook_pre_connection.
</DL>
<A NAME="lbBF">&nbsp;</A>
<H2>Unsupported API</H2>

<A NAME="ixADH"></A>
<TT>&quot;Apache2::Log&quot;</TT> also provides auto-generated Perl interface for a few
other methods which aren't tested at the moment and therefore their
<FONT SIZE="-1">API</FONT> is a subject to change. These methods will be finalized later as a
need arises. If you want to rely on any of the following methods
please contact the the mod_perl development mailing
list so we can help each other take the steps necessary
to shift the method to an officially supported <FONT SIZE="-1">API</FONT>.
<A NAME="lbBG">&nbsp;</A>
<H3>log_pid</H3>



<A NAME="ixADI"></A>
<FONT SIZE="-1">META:</FONT> what is this method good for? it just calls getpid and logs
it. In any case it has nothing to do with the logging <FONT SIZE="-1">API</FONT>. And it uses
static variables, it probably shouldn't be in the Apache public <FONT SIZE="-1">API</FONT>.
<P>

Log the current pid
<P>



<PRE>
  Apache2::Log::log_pid($pool, $fname);

</PRE>


<DL COMPACT>
<DT>obj: $p ( APR::Pool object )<DD>


<A NAME="ixADJ"></A>
The pool to use for logging
<DT>arg1: $fname ( file path )<DD>


<A NAME="ixADK"></A>
The name of the file to log to
<DT>ret: no return value<DD>
<A NAME="ixADL"></A>

<DT>since: subject to change<DD>
<A NAME="ixADM"></A>

</DL>
<A NAME="lbBH">&nbsp;</A>
<H2>See Also</H2>

<A NAME="ixADN"></A>
mod_perl 2.0 documentation.
<A NAME="lbBI">&nbsp;</A>
<H2>Copyright</H2>

<A NAME="ixADO"></A>
mod_perl 2.0 and its core modules are copyrighted under
The Apache Software License, Version 2.0.
<A NAME="lbBJ">&nbsp;</A>
<H2>Authors</H2>

<A NAME="ixADP"></A>
The mod_perl development team and numerous
contributors.
<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">NAME</A><DD>
<DT><A HREF="#lbAC">Synopsis</A><DD>
<DT><A HREF="#lbAD">Description</A><DD>
<DT><A HREF="#lbAE">Constants</A><DD>
<DL>
<DT><A HREF="#lbAF">LogLevel Constants</A><DD>
<DT><A HREF="#lbAG">Other Constants</A><DD>
</DL>
<DT><A HREF="#lbAH">Server Logging Methods</A><DD>
<DL>
<DT><A HREF="#lbAI">$s-&gt;log</A><DD>
<DT><A HREF="#lbAJ">$s-&gt;log_error</A><DD>
<DT><A HREF="#lbAK">$s-&gt;log_serror</A><DD>
<DT><A HREF="#lbAL">$s-&gt;warn</A><DD>
</DL>
<DT><A HREF="#lbAM">Request Logging Methods</A><DD>
<DL>
<DT><A HREF="#lbAN">$r-&gt;log</A><DD>
<DT><A HREF="#lbAO">$r-&gt;log_error</A><DD>
<DT><A HREF="#lbAP">$r-&gt;log_reason</A><DD>
<DT><A HREF="#lbAQ">$r-&gt;log_rerror</A><DD>
<DT><A HREF="#lbAR">$r-&gt;warn</A><DD>
</DL>
<DT><A HREF="#lbAS">Other Logging Methods</A><DD>
<DL>
<DT><A HREF="#lbAT">LogLevel Methods</A><DD>
<DT><A HREF="#lbAU">alert</A><DD>
<DT><A HREF="#lbAV">crit</A><DD>
<DT><A HREF="#lbAW">debug</A><DD>
<DT><A HREF="#lbAX">emerg</A><DD>
<DT><A HREF="#lbAY">error</A><DD>
<DT><A HREF="#lbAZ">info</A><DD>
<DT><A HREF="#lbBA">notice</A><DD>
<DT><A HREF="#lbBB">warn</A><DD>
</DL>
<DT><A HREF="#lbBC">General Functions</A><DD>
<DL>
<DT><A HREF="#lbBD">LOG_MARK</A><DD>
</DL>
<DT><A HREF="#lbBE">Virtual Hosts</A><DD>
<DT><A HREF="#lbBF">Unsupported API</A><DD>
<DL>
<DT><A HREF="#lbBG">log_pid</A><DD>
</DL>
<DT><A HREF="#lbBH">See Also</A><DD>
<DT><A HREF="#lbBI">Copyright</A><DD>
<DT><A HREF="#lbBJ">Authors</A><DD>
</DL>
<HR>
This document was created by
<A HREF="/manpages/index.html">man2html</A>,
using the manual pages.<BR>
Time: 05:33:11 GMT, December 24, 2015
</div></body>
</HTML>
