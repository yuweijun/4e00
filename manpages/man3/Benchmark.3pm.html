<!DOCTYPE html>

<HTML><head><TITLE>Manpage of Benchmark</TITLE>
<meta charset="utf-8">
<link rel="stylesheet" href="/css/main.css" type="text/css">
</head>
<body>
 <header class="site-header">
 <div class="wrap"> <div class="site-title"><a href="/manpages/index.html">linux manpages</a></div>
 <div class="site-description">{"type":"documentation"}</div>
 </div>
 </header>
 <div class="page-content"><div class="wrap">
<H1>Benchmark</H1>
Section: Perl Programmers Reference Guide (3pm)<BR>Updated: 2009-07-03<BR><A HREF="#index">Index</A>
<A HREF="/manpages/index.html">Return to Main Contents</A><HR>






<A NAME="lbAB">&nbsp;</A>
<H2>NAME</H2>

Benchmark - benchmark running times of Perl code
<A NAME="lbAC">&nbsp;</A>
<H2>SYNOPSIS</H2>

<A NAME="ixAAC"></A>


<PRE>
    use Benchmark qw(:all) ;

    timethis ($count, &quot;code&quot;);

    # Use Perl code in strings...
    timethese($count, {
        'Name1' =&gt; '...code1...',
        'Name2' =&gt; '...code2...',
    });

    # ... or use subroutine references.
    timethese($count, {
        'Name1' =&gt; sub { ...code1... },
        'Name2' =&gt; sub { ...code2... },
    });

    # cmpthese can be used both ways as well
    cmpthese($count, {
        'Name1' =&gt; '...code1...',
        'Name2' =&gt; '...code2...',
    });

    cmpthese($count, {
        'Name1' =&gt; sub { ...code1... },
        'Name2' =&gt; sub { ...code2... },
    });

    # ...or in two stages
    $results = timethese($count, 
        {
            'Name1' =&gt; sub { ...code1... },
            'Name2' =&gt; sub { ...code2... },
        },
        'none'
    );
    cmpthese( $results ) ;

    $t = timeit($count, '...other code...')
    print &quot;$count loops of other code took:&quot;,timestr($t),&quot;\n&quot;;

    $t = countit($time, '...other code...')
    $count = $t-&gt;iters ;
    print &quot;$count loops of other code took:&quot;,timestr($t),&quot;\n&quot;;

    # enable hires wallclock timing if possible
    use Benchmark ':hireswallclock';

</PRE>


<A NAME="lbAD">&nbsp;</A>
<H2>DESCRIPTION</H2>

<A NAME="ixAAD"></A>
The Benchmark module encapsulates a number of routines to help you
figure out how long it takes to execute some code.
<P>

timethis - run a chunk of code several times
<P>

timethese - run several chunks of code several times
<P>

cmpthese - print results of timethese as a comparison chart
<P>

timeit - run a chunk of code and see how long it goes
<P>

countit - see how many times a chunk of code runs in a given time
<A NAME="lbAE">&nbsp;</A>
<H3>Methods</H3>

<A NAME="ixAAE"></A>
<DL COMPACT>
<DT>new<DD>
<A NAME="ixAAF"></A>
Returns the current time.   Example:


<P>




<PRE>
    use Benchmark;
    $t0 = Benchmark-&gt;new;
    # ... your code here ...
    $t1 = Benchmark-&gt;new;
    $td = timediff($t1, $t0);
    print &quot;the code took:&quot;,timestr($td),&quot;\n&quot;;

</PRE>


<DT>debug<DD>
<A NAME="ixAAG"></A>
Enables or disable debugging by setting the <TT>$Benchmark::Debug</TT> flag:


<P>




<PRE>
    Benchmark-&gt;<A HREF="/manpages/index.html?1+debug">debug</A>(1);
    $t = timeit(10, ' 5 ** $Global ');
    Benchmark-&gt;debug(0);

</PRE>


<DT>iters<DD>
<A NAME="ixAAH"></A>
Returns the number of iterations.
</DL>
<A NAME="lbAF">&nbsp;</A>
<H3>Standard Exports</H3>

<A NAME="ixAAI"></A>
The following routines will be exported into your namespace
if you use the Benchmark module:
<DL COMPACT>
<DT>timeit(<FONT SIZE="-1">COUNT</FONT>, <FONT SIZE="-1">CODE</FONT>)<DD>
<A NAME="ixAAJ"></A>
Arguments: <FONT SIZE="-1">COUNT</FONT> is the number of times to run the loop, and <FONT SIZE="-1">CODE</FONT> is
the code to run.  <FONT SIZE="-1">CODE</FONT> may be either a code reference or a string to
be eval'd; either way it will be run in the caller's package.


<P>


Returns: a Benchmark object.
<DT>timethis ( <FONT SIZE="-1">COUNT</FONT>, <FONT SIZE="-1">CODE</FONT>, [ <FONT SIZE="-1">TITLE</FONT>, [ <FONT SIZE="-1">STYLE</FONT> ]] )<DD>
<A NAME="ixAAK"></A>
Time <FONT SIZE="-1">COUNT</FONT> iterations of <FONT SIZE="-1">CODE</FONT>. <FONT SIZE="-1">CODE</FONT> may be a string to eval or a
code reference; either way the <FONT SIZE="-1">CODE</FONT> will run in the caller's package.
Results will be printed to <FONT SIZE="-1">STDOUT</FONT> as <FONT SIZE="-1">TITLE</FONT> followed by the times.
<FONT SIZE="-1">TITLE</FONT> defaults to ``timethis <FONT SIZE="-1">COUNT</FONT>'' if none is provided. <FONT SIZE="-1">STYLE</FONT>
determines the format of the output, as described for <I>timestr()</I> below.


<P>


The <FONT SIZE="-1">COUNT</FONT> can be zero or negative: this means the <I>minimum number of
</I><FONT SIZE="-1"><I>CPU</I></FONT><I> seconds</I> to run.  A zero signifies the default of 3 seconds.  For
example to run at least for 10 seconds:


<P>




<PRE>
        timethis(-10, $code)

</PRE>




<P>


or to run two pieces of code tests for at least 3 seconds:


<P>




<PRE>
        timethese(0, { test1 =&gt; '...', test2 =&gt; '...'})

</PRE>




<P>


<FONT SIZE="-1">CPU</FONT> seconds is, in <FONT SIZE="-1">UNIX</FONT> terms, the user time plus the system time of
the process itself, as opposed to the real (wallclock) time and the
time spent by the child processes.  Less than 0.1 seconds is not
accepted (-0.01 as the count, for example, will cause a fatal runtime
exception).


<P>


Note that the <FONT SIZE="-1">CPU</FONT> seconds is the <B>minimum</B> time: <FONT SIZE="-1">CPU</FONT> scheduling and
other operating system factors may complicate the attempt so that a
little bit more time is spent.  The benchmark output will, however,
also tell the number of <TT>$code</TT> runs/second, which should be a more
interesting number than the actually spent seconds.


<P>


Returns a Benchmark object.
<DT>timethese ( <FONT SIZE="-1">COUNT</FONT>, <FONT SIZE="-1">CODEHASHREF</FONT>, [ <FONT SIZE="-1">STYLE</FONT> ] )<DD>
<A NAME="ixAAL"></A>
The <FONT SIZE="-1">CODEHASHREF</FONT> is a reference to a hash containing names as keys
and either a string to eval or a code reference for each value.
For each (<FONT SIZE="-1">KEY</FONT>, <FONT SIZE="-1">VALUE</FONT>) pair in the <FONT SIZE="-1">CODEHASHREF</FONT>, this routine will
call


<P>




<PRE>
        timethis(COUNT, VALUE, KEY, STYLE)

</PRE>




<P>


The routines are called in string comparison order of <FONT SIZE="-1">KEY</FONT>.


<P>


The <FONT SIZE="-1">COUNT</FONT> can be zero or negative, see <I>timethis()</I>.


<P>


Returns a hash reference of Benchmark objects, keyed by name.
<DT>timediff ( T1, T2 )<DD>
<A NAME="ixAAM"></A>
Returns the difference between two Benchmark times as a Benchmark
object suitable for passing to <I>timestr()</I>.
<DT>timestr ( <FONT SIZE="-1">TIMEDIFF</FONT>, [ <FONT SIZE="-1">STYLE</FONT>, [ <FONT SIZE="-1">FORMAT</FONT> ] ] )<DD>
<A NAME="ixAAN"></A>
Returns a string that formats the times in the <FONT SIZE="-1">TIMEDIFF</FONT> object in
the requested <FONT SIZE="-1">STYLE</FONT>. <FONT SIZE="-1">TIMEDIFF</FONT> is expected to be a Benchmark object
similar to that returned by <I>timediff()</I>.


<P>


<FONT SIZE="-1">STYLE</FONT> can be any of 'all', 'none', 'noc', 'nop' or 'auto'. 'all' shows
each of the 5 times available ('wallclock' time, user time, system time,
user time of children, and system time of children). 'noc' shows all
except the two children times. 'nop' shows only wallclock and the
two children times. 'auto' (the default) will act as 'all' unless
the children times are both zero, in which case it acts as 'noc'.
'none' prevents output.


<P>


<FONT SIZE="-1">FORMAT</FONT> is the <I><A HREF="/manpages/index.html?3+printf">printf</A></I>(3)-style format specifier (without the
leading '%') to use to print the times. It defaults to '5.2f'.
</DL>
<A NAME="lbAG">&nbsp;</A>
<H3>Optional Exports</H3>

<A NAME="ixAAO"></A>
The following routines will be exported into your namespace
if you specifically ask that they be imported:
<DL COMPACT>
<DT>clearcache ( <FONT SIZE="-1">COUNT</FONT> )<DD>
<A NAME="ixAAP"></A>
Clear the cached time for <FONT SIZE="-1">COUNT</FONT> rounds of the null loop.
<DT>clearallcache ( )<DD>
<A NAME="ixAAQ"></A>
Clear all cached times.
<DT>cmpthese ( <FONT SIZE="-1">COUNT</FONT>, <FONT SIZE="-1">CODEHASHREF</FONT>, [ <FONT SIZE="-1">STYLE</FONT> ] )<DD>
<A NAME="ixAAR"></A>

<DT>cmpthese ( <FONT SIZE="-1">RESULTSHASHREF</FONT>, [ <FONT SIZE="-1">STYLE</FONT> ] )<DD>
<A NAME="ixAAS"></A>

Optionally calls <I>timethese()</I>, then outputs comparison chart.  This:


<P>




<PRE>
    cmpthese( -1, { a =&gt; &quot;++\$i&quot;, b =&gt; &quot;\$i *= 2&quot; } ) ;

</PRE>




<P>


outputs a chart like:


<P>




<PRE>
           Rate    b    a
    b 2831802/s   -- -61%
    a 7208959/s 155%   --

</PRE>




<P>


This chart is sorted from slowest to fastest, and shows the percent speed
difference between each pair of tests.


<P>


<TT>&quot;cmpthese&quot;</TT> can also be passed the data structure that <I>timethese()</I> returns:


<P>




<PRE>
    $results = timethese( -1, { a =&gt; &quot;++\$i&quot;, b =&gt; &quot;\$i *= 2&quot; } ) ;
    cmpthese( $results );

</PRE>




<P>


in case you want to see both sets of results.
If the first argument is an unblessed hash reference,
that is <FONT SIZE="-1">RESULTSHASHREF</FONT>; otherwise that is <FONT SIZE="-1">COUNT</FONT>.


<P>


Returns a reference to an <FONT SIZE="-1">ARRAY</FONT> of rows, each row is an <FONT SIZE="-1">ARRAY</FONT> of cells from the
above chart, including labels. This:


<P>




<PRE>
    my $rows = cmpthese( -1, { a =&gt; '++$i', b =&gt; '$i *= 2' }, &quot;none&quot; );

</PRE>




<P>


returns a data structure like:


<P>




<PRE>
    [
        [ '',       'Rate',   'b',    'a' ],
        [ 'b', '2885232/s',  '--', '-59%' ],
        [ 'a', '7099126/s', '146%',  '--' ],
    ]

</PRE>




<P>


<B></B><FONT SIZE="-1"><B>NOTE</B></FONT><B></B>: This result value differs from previous versions, which returned
the <TT>&quot;timethese()&quot;</TT> result structure.  If you want that, just use the two
statement <TT>&quot;timethese&quot;</TT>...<TT>&quot;cmpthese&quot;</TT> idiom shown above.


<P>


Incidently, note the variance in the result values between the two examples;
this is typical of benchmarking.  If this were a real benchmark, you would
probably want to run a lot more iterations.
<DT>countit(<FONT SIZE="-1">TIME</FONT>, <FONT SIZE="-1">CODE</FONT>)<DD>
<A NAME="ixAAT"></A>
Arguments: <FONT SIZE="-1">TIME</FONT> is the minimum length of time to run <FONT SIZE="-1">CODE</FONT> for, and <FONT SIZE="-1">CODE</FONT> is
the code to run.  <FONT SIZE="-1">CODE</FONT> may be either a code reference or a string to
be eval'd; either way it will be run in the caller's package.


<P>


<FONT SIZE="-1">TIME</FONT> is <I>not</I> negative.  <I>countit()</I> will run the loop many times to
calculate the speed of <FONT SIZE="-1">CODE</FONT> before running it for <FONT SIZE="-1">TIME</FONT>.  The actual
time run for will usually be greater than <FONT SIZE="-1">TIME</FONT> due to system clock
resolution, so it's best to look at the number of iterations divided
by the times that you are concerned with, not just the iterations.


<P>


Returns: a Benchmark object.
<DT>disablecache ( )<DD>
<A NAME="ixAAU"></A>
Disable caching of timings for the null loop. This will force Benchmark
to recalculate these timings for each new piece of code timed.
<DT>enablecache ( )<DD>
<A NAME="ixAAV"></A>
Enable caching of timings for the null loop. The time taken for <FONT SIZE="-1">COUNT</FONT>
rounds of the null loop will be calculated only once for each
different <FONT SIZE="-1">COUNT</FONT> used.
<DT>timesum ( T1, T2 )<DD>
<A NAME="ixAAW"></A>
Returns the sum of two Benchmark times as a Benchmark object suitable
for passing to <I>timestr()</I>.
</DL>
<A NAME="lbAH">&nbsp;</A>
<H3>:hireswallclock</H3>

<A NAME="ixAAX"></A>
If the Time::HiRes module has been installed, you can specify the
special tag <TT>&quot;:hireswallclock&quot;</TT> for Benchmark (if Time::HiRes is not
available, the tag will be silently ignored).  This tag will cause the
wallclock time to be measured in microseconds, instead of integer
seconds.  Note though that the speed computations are still conducted
in <FONT SIZE="-1">CPU</FONT> time, not wallclock time.
<A NAME="lbAI">&nbsp;</A>
<H2>NOTES</H2>

<A NAME="ixAAY"></A>
The data is stored as a list of values from the time and times
functions:
<P>



<PRE>
      ($real, $user, $system, $children_user, $children_system, $iters)

</PRE>


<P>

in seconds for the whole loop (not divided by the number of rounds).
<P>

The timing is done using <I><A HREF="/manpages/index.html?3+time">time</A></I>(3) and <I><A HREF="http://localhost/cgi-bin/man/man2html?3+times">times</A></I>(3).
<P>

Code is executed in the caller's package.
<P>

The time of the null loop (a loop with the same
number of rounds but empty loop body) is subtracted
from the time of the real loop.
<P>

The null loop times can be cached, the key being the
number of rounds. The caching can be controlled using
calls like these:
<P>



<PRE>
    clearcache($key);
    clearallcache();

    disablecache();
    enablecache();

</PRE>


<P>

Caching is off by default, as it can (usually slightly) decrease
accuracy and does not usually noticably affect runtimes.
<A NAME="lbAJ">&nbsp;</A>
<H2>EXAMPLES</H2>

<A NAME="ixAAZ"></A>
For example,
<P>



<PRE>
    use Benchmark qw( cmpthese ) ;
    $x = 3;
    cmpthese( -5, {
        a =&gt; sub{$x*$x},
        b =&gt; sub{$x**2},
    } );

</PRE>


<P>

outputs something like this:
<P>



<PRE>
   Benchmark: running a, b, each for at least 5 CPU seconds...
          Rate    b    a
   b 1559428/s   -- -62%
   a 4152037/s 166%   --

</PRE>


<P>

while
<P>



<PRE>
    use Benchmark qw( timethese cmpthese ) ;
    $x = 3;
    $r = timethese( -5, {
        a =&gt; sub{$x*$x},
        b =&gt; sub{$x**2},
    } );
    cmpthese $r;

</PRE>


<P>

outputs something like this:
<P>



<PRE>
    Benchmark: running a, b, each for at least 5 CPU seconds...
             a: 10 wallclock secs ( 5.14 usr +  0.13 sys =  5.27 CPU) @ 3835055.60/s (n=20210743)
             b:  5 wallclock secs ( 5.41 usr +  0.00 sys =  5.41 CPU) @ 1574944.92/s (n=8520452)
           Rate    b    a
    b 1574945/s   -- -59%
    a 3835056/s 144%   --

</PRE>


<A NAME="lbAK">&nbsp;</A>
<H2>INHERITANCE</H2>

<A NAME="ixABA"></A>
Benchmark inherits from no other class, except of course
for Exporter.
<A NAME="lbAL">&nbsp;</A>
<H2>CAVEATS</H2>

<A NAME="ixABB"></A>
Comparing eval'd strings with code references will give you
inaccurate results: a code reference will show a slightly slower
execution time than the equivalent eval'd string.
<P>

The real time timing is done using <I><A HREF="/manpages/index.html?2+time">time</A></I>(2) and
the granularity is therefore only one second.
<P>

Short tests may produce negative figures because perl
can appear to take longer to execute the empty loop
than a short test; try:
<P>



<PRE>
    timethis(100,'1');

</PRE>


<P>

The system time of the null loop might be slightly
more than the system time of the loop with the actual
code and therefore the difference might end up being &lt; 0.
<A NAME="lbAM">&nbsp;</A>
<H2>SEE ALSO</H2>

<A NAME="ixABC"></A>
Devel::DProf - a Perl code profiler
<A NAME="lbAN">&nbsp;</A>
<H2>AUTHORS</H2>

<A NAME="ixABD"></A>
Jarkko Hietaniemi &lt;<I><A HREF="mailto:jhi@iki.fi">jhi@iki.fi</A></I>&gt;, Tim Bunce &lt;<I><A HREF="mailto:Tim.Bunce@ig.co.uk">Tim.Bunce@ig.co.uk</A></I>&gt;
<A NAME="lbAO">&nbsp;</A>
<H2>MODIFICATION HISTORY</H2>

<A NAME="ixABE"></A>
September 8th, 1994; by Tim Bunce.
<P>

March 28th, 1997; by Hugo van der Sanden: added support for code
references and the already documented 'debug' method; revamped
documentation.
<P>

April 04-07th, 1997: by Jarkko Hietaniemi, added the run-for-some-time
functionality.
<P>

September, 1999; by Barrie Slaymaker: math fixes and accuracy and 
efficiency tweaks.  Added <I>cmpthese()</I>.  A result is now returned from 
<I>timethese()</I>.  Exposed <I>countit()</I> (was <I>runfor()</I>).
<P>

December, 2001; by Nicholas Clark: make <I>timestr()</I> recognise the style 'none'
and return an empty string. If cmpthese is calling timethese, make it pass the
style in. (so that 'none' will suppress output). Make sub new dump its
debugging output to <FONT SIZE="-1">STDERR</FONT>, to be consistent with everything else.
All bugs found while writing a regression test.
<P>

September, 2002; by Jarkko Hietaniemi: add ':hireswallclock' special tag.
<P>

February, 2004; by Chia-liang Kao: make cmpthese and timestr use time
statistics for children instead of parent when the style is 'nop'.
<P>

November, 2007; by Christophe Grosjean: make cmpthese and timestr compute
time consistently with style argument, default is 'all' not 'noc' any more.
<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">NAME</A><DD>
<DT><A HREF="#lbAC">SYNOPSIS</A><DD>
<DT><A HREF="#lbAD">DESCRIPTION</A><DD>
<DL>
<DT><A HREF="#lbAE">Methods</A><DD>
<DT><A HREF="#lbAF">Standard Exports</A><DD>
<DT><A HREF="#lbAG">Optional Exports</A><DD>
<DT><A HREF="#lbAH">:hireswallclock</A><DD>
</DL>
<DT><A HREF="#lbAI">NOTES</A><DD>
<DT><A HREF="#lbAJ">EXAMPLES</A><DD>
<DT><A HREF="#lbAK">INHERITANCE</A><DD>
<DT><A HREF="#lbAL">CAVEATS</A><DD>
<DT><A HREF="#lbAM">SEE ALSO</A><DD>
<DT><A HREF="#lbAN">AUTHORS</A><DD>
<DT><A HREF="#lbAO">MODIFICATION HISTORY</A><DD>
</DL>
<HR>
This document was created by
<A HREF="/manpages/index.html">man2html</A>,
using the manual pages.<BR>
Time: 05:33:12 GMT, December 24, 2015
</div></div>
</body>
</HTML>
