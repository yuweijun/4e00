<!DOCTYPE html>

<HTML><head><TITLE>Manpage of guestfs-perl</TITLE>
<meta charset="utf-8">
<link rel="stylesheet" href="/css/main.css" type="text/css">
</head>
<body>
 <header class="site-header">
 <div class="wrap"> <div class="site-title"><a href="/manpages/index.html">linux manpages</a></div>
 <div class="site-description">{"type":"programming"}</div>
 </div>
 </header>
 <div class="page-content"><div class="wrap">
<H1>guestfs-perl</H1>
Section: Virtualization Support (3)<BR>Updated: 2012-06-22<BR><A HREF="#index">Index</A>
<A HREF="/manpages/index.html">Return to Main Contents</A><HR>






<A NAME="lbAB">&nbsp;</A>
<H2>NAME</H2>

guestfs-perl - How to use libguestfs from Perl
<A NAME="lbAC">&nbsp;</A>
<H2>SYNOPSIS</H2>

<A NAME="ixAAC"></A>


<PRE>
 use Sys::Guestfs;
 
 my $h = Sys::Guestfs-&gt;new ();
 $h-&gt;add_drive_opts ('guest.img', format =&gt; 'raw');
 $h-&gt;launch ();
 $h-&gt;mount_options ('', '/dev/sda1', '/');
 $h-&gt;touch ('/hello');
 $h-&gt;sync ();

</PRE>


<A NAME="lbAD">&nbsp;</A>
<H2>DESCRIPTION</H2>

<A NAME="ixAAD"></A>
This manual page documents how to call libguestfs from the Perl
programming language.  This page just documents the differences from
the C <FONT SIZE="-1">API</FONT> and gives some examples.  If you are not familiar with using
libguestfs, you also need to read <I><A HREF="/manpages/index.html?3+guestfs">guestfs</A></I>(3).  To read the
full Perl <FONT SIZE="-1">API</FONT>, see <I><A HREF="/manpages/index.html?3+Sys::Guestfs">Sys::Guestfs</A></I>(3).
<A NAME="lbAE">&nbsp;</A>
<H3><FONT SIZE="-1">ERRORS</FONT></H3>

<A NAME="ixAAE"></A>
Errors from libguestfs functions turn into calls to
<TT>&quot;croak&quot;</TT> (see <I><A HREF="/manpages/index.html?3+Carp">Carp</A></I>(3)).
<A NAME="lbAF">&nbsp;</A>
<H2>EXAMPLE 1: CREATE A DISK IMAGE</H2>

<A NAME="ixAAF"></A>


<PRE>
 #!/usr/bin/perl -w
 
 # Example showing how to create a disk image.
 
 use strict;
 use Sys::Guestfs;
 
 my $output = &quot;disk.img&quot;;
 
 my $g = new Sys::Guestfs ();
 
 # Create a raw-format sparse disk image, 512 MB in size.
 open FILE, &quot;&gt;$output&quot; or die &quot;$output: $!&quot;;
 truncate FILE, 512 * 1024 * 1024 or die &quot;$output: truncate: $!&quot;;
 close FILE or die &quot;$output: $!&quot;;
 
 # Set the trace flag so that we can see each libguestfs call.
 $g-&gt;set_trace (1);
 
 # Set the autosync flag so that the disk will be synchronized
 # automatically when the libguestfs handle is closed.
 $g-&gt;set_autosync (1);
 
 # Attach the disk image to libguestfs.
 $g-&gt;add_drive_opts ($output, format =&gt; &quot;raw&quot;, readonly =&gt; 0);
 
 # Run the libguestfs back-end.
 $g-&gt;launch ();
 
 # Get the list of devices.  Because we only added one drive
 # above, we expect that this list should contain a single
 # element.
 my @devices = $g-&gt;list_devices ();
 if (@devices != 1) {
     die &quot;error: expected a single device from list-devices&quot;;
 }
 
 # Partition the disk as one single MBR partition.
 $g-&gt;part_disk ($devices[0], &quot;mbr&quot;);
 
 # Get the list of partitions.  We expect a single element, which
 # is the partition we have just created.
 my @partitions = $g-&gt;list_partitions ();
 if (@partitions != 1) {
     die &quot;error: expected a single partition from list-partitions&quot;;
 }
 
 # Create a filesystem on the partition.
 $g-&gt;mkfs (&quot;ext4&quot;, $partitions[0]);
 
 # Now mount the filesystem so that we can add files.
 $g-&gt;mount_options (&quot;&quot;, $partitions[0], &quot;/&quot;);
 
 # Create some files and directories.
 $g-&gt;touch (&quot;/empty&quot;);
 my $message = &quot;Hello, world\n&quot;;
 $g-&gt;write (&quot;/hello&quot;, $message);
 $g-&gt;mkdir (&quot;/foo&quot;);
 
 # This one uploads the local file /etc/resolv.conf into
 # the disk image.
 $g-&gt;upload (&quot;/etc/resolv.conf&quot;, &quot;/foo/resolv.conf&quot;);
 
 # Because 'autosync' was set (above) we can just exit here
 # and the disk contents will be synchronized.  You can also do
 # this manually by calling $g-&gt;umount_all and $g-&gt;sync.
 exit 0

</PRE>


<A NAME="lbAG">&nbsp;</A>
<H2>EXAMPLE 2: INSPECT A VIRTUAL MACHINE DISK IMAGE</H2>

<A NAME="ixAAG"></A>


<PRE>
 #!/usr/bin/perl -w
 
 # Example showing how to inspect a virtual machine disk.
 
 use strict;
 use Sys::Guestfs;
 
 if (@ARGV &lt; 1) {
     die &quot;usage: inspect_vm disk.img&quot;
 }
 
 my $disk = $ARGV[0];
 
 my $g = new Sys::Guestfs ();
 
 # Attach the disk image read-only to libguestfs.
 # You could also add an optional format =&gt; ... argument here.  This is
 # advisable since automatic format detection is insecure.
 $g-&gt;add_drive_opts ($disk, readonly =&gt; 1);
 
 # Run the libguestfs back-end.
 $g-&gt;launch ();
 
 # Ask libguestfs to inspect for operating systems.
 my @roots = $g-&gt;inspect_os ();
 if (@roots == 0) {
     die &quot;inspect_vm: no operating systems found&quot;;
 }
 
 for my $root (@roots) {
     printf &quot;Root device: %s\n&quot;, $root;
 
     # Print basic information about the operating system.
     printf &quot;  Product name: %s\n&quot;, $g-&gt;inspect_get_product_name ($root);
     printf &quot;  Version:      %d.%d\n&quot;,
         $g-&gt;inspect_get_major_version ($root),
         $g-&gt;inspect_get_minor_version ($root);
     printf &quot;  Type:         %s\n&quot;, $g-&gt;inspect_get_type ($root);
     printf &quot;  Distro:       %s\n&quot;, $g-&gt;inspect_get_distro ($root);
 
     # Mount up the disks, like guestfish -i.
     #
     # Sort keys by length, shortest first, so that we end up
     # mounting the filesystems in the correct order.
     my %mps = $g-&gt;inspect_get_mountpoints ($root);
     my @mps = sort { length $a &lt;=&gt; length $b } (keys %mps);
     for my $mp (@mps) {
         eval { $g-&gt;mount_ro ($mps{$mp}, $mp) };
         if ($@) {
             print &quot;$@ (ignored)\n&quot;
         }
     }
 
     # If /etc/issue.net file exists, print up to 3 lines.
     my $filename = &quot;/etc/issue.net&quot;;
     if ($g-&gt;is_file ($filename)) {
         printf &quot;--- %s ---\n&quot;, $filename;
         my @lines = $g-&gt;head_n (3, $filename);
         print &quot;$_\n&quot; foreach @lines;
     }
 
     # Unmount everything.
     $g-&gt;umount_all ()
 }

</PRE>


<A NAME="lbAH">&nbsp;</A>
<H2>SEE ALSO</H2>

<A NAME="ixAAH"></A>
<I><A HREF="/manpages/index.html?3+Sys::Guestfs">Sys::Guestfs</A></I>(3),
<I><A HREF="/manpages/index.html?3+guestfs">guestfs</A></I>(3),
<I><A HREF="/manpages/index.html?3+guestfs-examples">guestfs-examples</A></I>(3),
<I><A HREF="/manpages/index.html?3+guestfs-erlang">guestfs-erlang</A></I>(3),
<I><A HREF="/manpages/index.html?3+guestfs-java">guestfs-java</A></I>(3),
<I><A HREF="/manpages/index.html?3+guestfs-ocaml">guestfs-ocaml</A></I>(3),
<I><A HREF="/manpages/index.html?3+guestfs-python">guestfs-python</A></I>(3),
<I><A HREF="/manpages/index.html?1+guestfs-recipes">guestfs-recipes</A></I>(1),
<I><A HREF="/manpages/index.html?3+guestfs-ruby">guestfs-ruby</A></I>(3),
&lt;<A HREF="http://libguestfs.org/">http://libguestfs.org/</A>&gt;.
<A NAME="lbAI">&nbsp;</A>
<H2>AUTHORS</H2>

<A NAME="ixAAI"></A>
Richard W.M. Jones (<TT>&quot;rjones at redhat dot com&quot;</TT>)
<A NAME="lbAJ">&nbsp;</A>
<H2>COPYRIGHT</H2>

<A NAME="ixAAJ"></A>
Copyright (C) 2011 Red Hat Inc. &lt;<A HREF="http://libguestfs.org/">http://libguestfs.org/</A>&gt;
<P>

The examples in this manual page may be freely copied, modified and
distributed without any restrictions.
<P>

This library is free software; you can redistribute it and/or
modify it under the terms of the <FONT SIZE="-1">GNU</FONT> Lesser General Public
License as published by the Free Software Foundation; either
version 2 of the License, or (at your option) any later version.
<P>

This library is distributed in the hope that it will be useful,
but <FONT SIZE="-1">WITHOUT</FONT> <FONT SIZE="-1">ANY</FONT> <FONT SIZE="-1">WARRANTY</FONT>; without even the implied warranty of
<FONT SIZE="-1">MERCHANTABILITY</FONT> or <FONT SIZE="-1">FITNESS</FONT> <FONT SIZE="-1">FOR</FONT> A <FONT SIZE="-1">PARTICULAR</FONT> <FONT SIZE="-1">PURPOSE</FONT>.  See the <FONT SIZE="-1">GNU</FONT>
Lesser General Public License for more details.
<P>

You should have received a copy of the <FONT SIZE="-1">GNU</FONT> Lesser General Public
License along with this library; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, <FONT SIZE="-1">MA</FONT> 02110-1301 <FONT SIZE="-1">USA</FONT>
<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">NAME</A><DD>
<DT><A HREF="#lbAC">SYNOPSIS</A><DD>
<DT><A HREF="#lbAD">DESCRIPTION</A><DD>
<DL>
<DT><A HREF="#lbAE"><FONT SIZE="-1">ERRORS</FONT></A><DD>
</DL>
<DT><A HREF="#lbAF">EXAMPLE 1: CREATE A DISK IMAGE</A><DD>
<DT><A HREF="#lbAG">EXAMPLE 2: INSPECT A VIRTUAL MACHINE DISK IMAGE</A><DD>
<DT><A HREF="#lbAH">SEE ALSO</A><DD>
<DT><A HREF="#lbAI">AUTHORS</A><DD>
<DT><A HREF="#lbAJ">COPYRIGHT</A><DD>
</DL>
<HR>
This document was created by
<A HREF="/manpages/index.html">man2html</A>,
using the manual pages.<BR>
Time: 05:33:28 GMT, December 24, 2015
</div></div>
</body>
</HTML>
