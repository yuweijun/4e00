<!DOCTYPE html>

<HTML><head><TITLE>Manpage of docs::api::APR::PerlIO</TITLE>
<meta charset="utf-8">
<link rel="stylesheet" href="/css/main.css" type="text/css">
</head>
<body>
 <header class="site-header">
 <div class="wrap"> <div class="site-title"><a href="/manpages/index.html">linux manpages</a></div>
 <div class="site-description">{"type":"programming"}</div>
 </div>
 </header>
 <div class="page-content">
<H1>docs::api::APR::PerlIO</H1>
Section: User Contributed Perl Documentation (3)<BR>Updated: 2007-11-12<BR><A HREF="#index">Index</A>
<A HREF="/manpages/index.html">Return to Main Contents</A><HR>






<A NAME="lbAB">&nbsp;</A>
<H2>NAME</H2>

APR::PerlIO -- Perl IO layer for APR
<A NAME="lbAC">&nbsp;</A>
<H2>Synopsis</H2>

<A NAME="ixAAC"></A>


<PRE>
  # under mod_perl
  use APR::PerlIO ();
  
  sub handler {
      my $r = shift;
  
      die &quot;This Perl build doesn't support PerlIO layers&quot;
          unless APR::PerlIO::PERLIO_LAYERS_ARE_ENABLED;
  
      open my $fh, &quot;&gt;:APR&quot;, $filename, $r-&gt;pool or die $!;
      # work with $fh as normal $fh
      close $fh;
  
      return Apache2::Const::OK;
  }

  # outside mod_perl
  % perl -MAPR -MAPR::PerlIO -MAPR::Pool -le \
  'open my $fh, &quot;&gt;:APR&quot;, &quot;/tmp/apr&quot;, APR::Pool-&gt;new or die &quot;$!&quot;; \
   print $fh &quot;whoah!&quot;; \
   close $fh;'

</PRE>


<A NAME="lbAD">&nbsp;</A>
<H2>Description</H2>

<A NAME="ixAAD"></A>
<TT>&quot;APR::PerlIO&quot;</TT> implements a Perl <FONT SIZE="-1">IO</FONT> layer using <FONT SIZE="-1">APR</FONT>'s file
manipulation <FONT SIZE="-1">API</FONT> internally.
<P>

Why do you want to use this? Normally you shouldn't, probably it won't
be faster than Perl's default layer. It's only useful when you need to
manipulate a filehandle opened at the <FONT SIZE="-1">APR</FONT> side, while using Perl.
<P>

Normally you won't call <I>open()</I> with <FONT SIZE="-1">APR</FONT> layer attribute, but some
mod_perl functions will return a filehandle which is internally hooked
to <FONT SIZE="-1">APR</FONT>. But you can use <FONT SIZE="-1">APR</FONT> Perl <FONT SIZE="-1">IO</FONT> directly if you want.
<A NAME="lbAE">&nbsp;</A>
<H2>Prerequisites</H2>

<A NAME="ixAAE"></A>
Not every Perl will have full <TT>&quot;APR::PerlIO&quot;</TT> functionality available.
<P>

Before using the Perl <FONT SIZE="-1">IO</FONT> <FONT SIZE="-1">APR</FONT> layer one has to check whether it's
supported by the used APR/Perl build. Perl 5.8.x or higher with perlio
enabled is required. You can check whether your Perl fits the bill by
running:
<P>



<PRE>
  % perl -V:useperlio
  useperlio='define';

</PRE>


<P>

It should say <I>define</I>.
<P>

If you need to do the checking in the code, there is a special
constant provided by <TT>&quot;APR::PerlIO&quot;</TT>, which can be used as follows:
<P>



<PRE>
  use APR::PerlIO ();
  die &quot;This Perl build doesn't support PerlIO layers&quot;
      unless APR::PerlIO::PERLIO_LAYERS_ARE_ENABLED;

</PRE>


<P>

Notice that loading <TT>&quot;APR::PerlIO&quot;</TT> won't fail when Perl <FONT SIZE="-1">IO</FONT> layers
aren't available since <TT>&quot;APR::PerlIO&quot;</TT> provides functionality for Perl
builds not supporting Perl <FONT SIZE="-1">IO</FONT> layers.
<A NAME="lbAF">&nbsp;</A>
<H2>Constants</H2>

<A NAME="ixAAF"></A>
<A NAME="lbAG">&nbsp;</A>
<H3>APR::PerlIO::PERLIO_LAYERS_ARE_ENABLED</H3>



<A NAME="ixAAG"></A>
See Prerequisites.
<A NAME="lbAH">&nbsp;</A>
<H2>API</H2>

<A NAME="ixAAH"></A>
Most of the <FONT SIZE="-1">API</FONT> is as in normal perl <FONT SIZE="-1">IO</FONT> with a few nuances listed in
the following sections.
<P>

<FONT SIZE="-1">META:</FONT> need to rework the exception mechanism here. Current success in
using errno ($!) being set (e.g. on <I>open()</I>) is purely accidental and
not guaranteed across all platforms and functions. So don't rely on
$!. Will use <TT>&quot;APR::Error&quot;</TT> for that
purpose.
<A NAME="lbAI">&nbsp;</A>
<H3>open</H3>



<A NAME="ixAAI"></A>
Open a file via <FONT SIZE="-1">APR</FONT> Perl <FONT SIZE="-1">IO</FONT> layer.
<P>



<PRE>
  open my $fh, &quot;&gt;:APR&quot;, $filename, $r-&gt;pool or die $!;

</PRE>


<DL COMPACT>
<DT>arg1: $fh ( <FONT SIZE="-1">GLOB</FONT> filehandle )<DD>


<A NAME="ixAAJ"></A>
The filehandle.
<DT>arg2: $mode ( string )<DD>


<A NAME="ixAAK"></A>
The mode to open the file, constructed from two sections separated by
the <TT>&quot;:&quot;</TT> character: the first section is the mode to open the file
under (&gt;, &lt;, etc) and the second section must be a string
<I></I><FONT SIZE="-1"><I>APR</I></FONT><I></I>. For more information refer to the <I>open</I> entry in the
<I>perlfunc</I> manpage.
<DT>arg3: $filename ( string )<DD>


<A NAME="ixAAL"></A>
The path to the filename to open
<DT>arg4: $p ( APR::Pool )<DD>


<A NAME="ixAAM"></A>
The pool object to use to allocate APR::PerlIO layer.
<DT>ret: ( integer )<DD>
<A NAME="ixAAN"></A>
success or failure value (boolean).
<DT>since: 2.0.00<DD>
<A NAME="ixAAO"></A>
</DL>
<A NAME="lbAJ">&nbsp;</A>
<H3>seek</H3>



<A NAME="ixAAP"></A>
Sets <TT>$fh</TT>'s position, just like the <TT>&quot;seek()&quot;</TT> Perl call:
<P>



<PRE>
  seek($fh, $offset, $whence);

</PRE>


<P>

If <TT>$offset</TT> is zero, <TT>&quot;seek()&quot;</TT> works normally.
<P>

However if <TT>$offset</TT> is non-zero and Perl has been compiled with with
large files support (<TT>&quot;-Duselargefiles&quot;</TT>), whereas <FONT SIZE="-1">APR</FONT> wasn't, this
function will croak. This is because largefile size <TT>&quot;Off_t&quot;</TT> simply
cannot fit into a non-largefile size <TT>&quot;apr_off_t&quot;</TT>.
<P>

To solve the problem, rebuild Perl with <TT>&quot;-Uuselargefiles&quot;</TT>. Currently
there is no way to force <FONT SIZE="-1">APR</FONT> to build with large files support.
<DL COMPACT>
<DT>since: 2.0.00<DD>
<A NAME="ixAAQ"></A>
</DL>
<A NAME="lbAK">&nbsp;</A>
<H2>C API</H2>

<A NAME="ixAAR"></A>
The C <FONT SIZE="-1">API</FONT> provides functions to convert between Perl <FONT SIZE="-1">IO</FONT> and <FONT SIZE="-1">APR</FONT> Perl
<FONT SIZE="-1">IO</FONT> filehandles.
<P>

<FONT SIZE="-1">META:</FONT> document these
<A NAME="lbAL">&nbsp;</A>
<H2>See Also</H2>

<A NAME="ixAAS"></A>
mod_perl 2.0 documentation. The <I><A HREF="/manpages/index.html?1+perliol">perliol</A>(1)</I>,
<I><A HREF="/manpages/index.html?1+perlapio">perlapio</A>(1)</I> and <I><A HREF="http://localhost/cgi-bin/man/man2html?1+perl">perl</A>(1)</I> manpages.
<A NAME="lbAM">&nbsp;</A>
<H2>Copyright</H2>

<A NAME="ixAAT"></A>
mod_perl 2.0 and its core modules are copyrighted under
The Apache Software License, Version 2.0.
<A NAME="lbAN">&nbsp;</A>
<H2>Authors</H2>

<A NAME="ixAAU"></A>
The mod_perl development team and numerous
contributors.
<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">NAME</A><DD>
<DT><A HREF="#lbAC">Synopsis</A><DD>
<DT><A HREF="#lbAD">Description</A><DD>
<DT><A HREF="#lbAE">Prerequisites</A><DD>
<DT><A HREF="#lbAF">Constants</A><DD>
<DL>
<DT><A HREF="#lbAG">APR::PerlIO::PERLIO_LAYERS_ARE_ENABLED</A><DD>
</DL>
<DT><A HREF="#lbAH">API</A><DD>
<DL>
<DT><A HREF="#lbAI">open</A><DD>
<DT><A HREF="#lbAJ">seek</A><DD>
</DL>
<DT><A HREF="#lbAK">C API</A><DD>
<DT><A HREF="#lbAL">See Also</A><DD>
<DT><A HREF="#lbAM">Copyright</A><DD>
<DT><A HREF="#lbAN">Authors</A><DD>
</DL>
<HR>
This document was created by
<A HREF="/manpages/index.html">man2html</A>,
using the manual pages.<BR>
Time: 05:33:11 GMT, December 24, 2015
</div></body>
</HTML>
