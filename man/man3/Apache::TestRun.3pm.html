<!DOCTYPE html>

<HTML><head><TITLE>Manpage of Apache::TestRun</TITLE>
<meta charset="utf-8">
<link rel="stylesheet" href="/css/main.css" type="text/css">
</head>
<body>
 <header class="site-header">
 <div class="wrap"> <div class="site-title"><a href="/man/index.html">linux man pages</a></div>
 <div class="site-description">{"type":"programming"}</div>
 </div>
 </header>
 <div class="page-content">
<H1>Apache::TestRun</H1>
Section: User Contributed Perl Documentation (3)<BR>Updated: 2008-02-25<BR><A HREF="#index">Index</A>
<A HREF="/man/index.html">Return to Main Contents</A><HR>






<A NAME="lbAB">&nbsp;</A>
<H2>NAME</H2>

Apache::TestRun - Run the test suite
<A NAME="lbAC">&nbsp;</A>
<H2>SYNOPSIS</H2>

<A NAME="ixAAC"></A>
<A NAME="lbAD">&nbsp;</A>
<H2>DESCRIPTION</H2>

<A NAME="ixAAD"></A>
The <TT>&quot;Apache::TestRun&quot;</TT> package controls the configuration and running
of the test suite.
<A NAME="lbAE">&nbsp;</A>
<H2>METHODS</H2>

<A NAME="ixAAE"></A>
Several methods are sub-classable, if the default behavior should be
changed.
<A NAME="lbAF">&nbsp;</A>
<H3>bug_report</H3>



<A NAME="ixAAF"></A>
The <TT>&quot;bug_report()&quot;</TT> method is executed when <TT>&quot;t/TEST&quot;</TT> was executed
with the <TT>&quot;-bugreport&quot;</TT> option, and <TT>&quot;make test&quot;</TT> (or <TT>&quot;t/TEST&quot;</TT>)
fail. Normally this is callback which you can use to tell the user how
to deal with the problem, e.g. suggesting to read some document or
email some details to someone who can take care of it. By default
nothing is executed.
<P>

The <TT>&quot;-bugreport&quot;</TT> option is needed so this feature won't become
annoying to developers themselves. It's automatically added to the
<TT>&quot;run_tests&quot;</TT> target in <I>Makefile</I>. So if you repeateadly have to test
your code, just don't use <TT>&quot;make test&quot;</TT> but run <TT>&quot;t/TEST&quot;</TT>
directly. Here is an example of a custom <TT>&quot;t/TEST&quot;</TT>
<P>



<PRE>
  My::TestRun-&gt;new-&gt;run(@ARGV);

  package My::TestRun;
  use base 'Apache::TestRun';

  sub bug_report {
      my $self = shift;

      print &lt;&lt;EOI;
  +--------------------------------------------------------+
  | Please file a bug report: <A HREF="http://perl.apache.org/bugs/">http://perl.apache.org/bugs/</A> |
  +--------------------------------------------------------+
  EOI
  }

</PRE>


<A NAME="lbAG">&nbsp;</A>
<H3>pre_configure</H3>



<A NAME="ixAAG"></A>
The <TT>&quot;pre_configure()&quot;</TT> method is executed before the configuration for
<TT>&quot;Apache::Test&quot;</TT> is generated. So if you need to adjust the setup
before <I>httpd.conf</I> and other files are autogenerated, this is the
right place to do so.
<P>

For example if you don't want to inherit a LoadModule directive for
<I>mod_apreq.so</I> but to make sure that the local version is used, you
can sub-class <TT>&quot;Apache::TestRun&quot;</TT> and override this method in
<I>t/TEST.PL</I>:
<P>



<PRE>
  package My::TestRun;
  use base 'Apache::TestRun';
  use Apache::TestConfig;
  __PACKAGE__-&gt;new-&gt;run(@ARGV);

  sub pre_configure {
      my $self = shift;
      # Don't load an installed mod_apreq
      Apache::TestConfig::autoconfig_skip_module_add('mod_apreq.c');

      $self-&gt;SUPER::pre_configure();
  }

</PRE>


<P>

Notice that the extension is <I>.c</I>, and not <I>.so</I>.
<P>

Don't forget to run the super class' c&lt;<I>pre_configure()</I>&gt; method.
<A NAME="lbAH">&nbsp;</A>
<H3>new_test_config</H3>



<A NAME="ixAAH"></A>
<FONT SIZE="-1">META:</FONT> to be completed
<A NAME="lbAI">&nbsp;</A>
<H2>Persistent Custom Configuration</H2>

<A NAME="ixAAI"></A>
When <TT>&quot;Apache::Test&quot;</TT> is first installed or used, it will save the
values of <TT>&quot;httpd&quot;</TT>, <TT>&quot;apxs&quot;</TT>, <TT>&quot;port&quot;</TT>, <TT>&quot;user&quot;</TT>, and <TT>&quot;group&quot;</TT>, if set,
to a configuration file <TT>&quot;Apache::TestConfigData&quot;</TT>.  This information
will then be used in setting these options for subsequent uses of
<TT>&quot;Apache-Test&quot;</TT> unless temprorarily overridden, either by setting the
appropriate environment variable (<TT>&quot;APACHE_TEST_HTTPD&quot;</TT>,
<TT>&quot;APACHE_TEST_APXS&quot;</TT>, <TT>&quot;APACHE_TEST_PORT&quot;</TT>, <TT>&quot;APACHE_TEST_USER&quot;</TT>, and
<TT>&quot;APACHE_TEST_GROUP&quot;</TT>) or by giving the relevant option (<TT>&quot;-httpd&quot;</TT>,
<TT>&quot;-apxs&quot;</TT>, <TT>&quot;-port&quot;</TT>, <TT>&quot;-user&quot;</TT>, and <TT>&quot;-group&quot;</TT>) when the <TT>&quot;TEST&quot;</TT> script
is run.
<P>

To avoid either using previous persistent configurations or saving
current configurations, set the <TT>&quot;APACHE_TEST_NO_STICKY_PREFERENCES&quot;</TT>
environment variable to a true value.
<P>

Finally it's possible to permanently override the previously saved
options by passing <TT>&quot;-save&quot;</TT>.
<P>

Here is the algorithm of how and when options are saved for the first
time and when they are used. We will use a few variables to simplify
the pseudo-code/pseudo-chart flow:
<P>

<TT>$config_exists</TT> - custom configuration has already been saved, to
get this setting run <TT>&quot;custom_config_exists()&quot;</TT>, which tests whether
either <TT>&quot;apxs&quot;</TT> or <TT>&quot;httpd&quot;</TT> values are set. It doesn't check for other
values, since all we need is <TT>&quot;apxs&quot;</TT> or <TT>&quot;httpd&quot;</TT> to get the test suite
running. <I>custom_config_exists()</I> checks in the following order
<I>lib/Apache/TestConfigData.pm</I> (if during Apache-Test build) ,
<I>~/.apache-test/Apache/TestConfigData.pm</I> and
<I>Apache/TestConfigData.pm</I> in the perl's libraries.
<P>

<TT>$config_overriden</TT> - that means that we have either <TT>&quot;apxs&quot;</TT> or
<TT>&quot;httpd&quot;</TT> values provided by user, via env vars or command line options.
<DL COMPACT>
<DT>1 Building Apache-Test or modperl-2.0 (or any other project that bundles Apache-Test).<DD>
<A NAME="ixAAJ"></A>


<PRE>
  1) perl Apache-Test/Makefile.PL
  (for bundles top-level Makefile.PL will run this as well)

  if $config_exists
      do nothing
  else
      create lib/Apache/TestConfigData.pm w/ empty config: {}

  2) make

  3) make test

  if $config_exists
      if $config_overriden
          override saved options (for those that were overriden)
      else
          use saved options
  else
      if $config_overriden
          save them in lib/Apache/TestConfigData.pm
          (which will be installed on 'make install')
      else
          - run interactive prompt for C&lt;httpd&gt; and optionally for C&lt;apxs&gt;
          - save the custom config in lib/Apache/TestConfigData.pm
          - restart the currently run program

  modperl-2.0 is a special case in (3). it always overrides 'httpd'
  and 'apxs' settings. Other settings like 'port', can be used from
  the saved config.

  4) make install

     if $config_exists only in lib/Apache/TestConfigData.pm
        it will be installed system-wide
     else
        nothing changes (since lib/Apache/TestConfigData.pm won't exist)

</PRE>


<DT>2 Testing 3rd party modules (after Apache-Test was installed)<DD>
<A NAME="ixAAK"></A>
Notice that the following situation is quite possible:


<P>




<PRE>
  cd Apache-Test
  perl Makefile.PL &amp;&amp; make install

</PRE>




<P>


so that Apache-Test was installed but no custom configuration saved
(since its <TT>&quot;make test&quot;</TT> wasn't run). In which case the interactive
configuration should kick in (unless config options were passed) and
in any case saved once configured.


<P>


<TT>$custom_config_path</TT> - perl's <I>Apache/TestConfigData.pm</I> (at the
same location as <I>Apache/TestConfig.pm</I>) if that area is writable by
that user (e.g. perl's lib is not owned by 'root'). If not, in
<I>~/.apache-test/Apache/TestConfigData.pm</I>.


<P>




<PRE>
  1) perl Apache-Test/Makefile.PL
  2) make
  3) make test

  if $config_exists
      if $config_overriden
          override saved options (for those that were overriden)
      else
          use saved options
  else
      if $config_overriden
          save them in $custom_config_path
      else
          - run interactive prompt for C&lt;httpd&gt; and optionally for C&lt;apxs&gt;
          - save the custom config in $custom_config_path
          - restart the currently run program

  4) make install

</PRE>


</DL>
<A NAME="lbAJ">&nbsp;</A>
<H3>Saving Custom Configuration Options</H3>

<A NAME="ixAAL"></A>
If you want to override the existing custom configurations options to
<TT>&quot;Apache::TestConfigData&quot;</TT>, use the <TT>&quot;-save&quot;</TT> flag when running <TT>&quot;TEST&quot;</TT>.
<P>

If you are running <TT>&quot;Apache::Test&quot;</TT> as a user who does not have
permission to alter the system <TT>&quot;Apache::TestConfigData&quot;</TT>, you can
place your own private configuration file <I>TestConfigData.pm</I> under
<TT>&quot;$ENV{HOME}/.apache-test/Apache/&quot;</TT>, which <TT>&quot;Apache::Test&quot;</TT> will use, if
present. An example of such a configuration file is
<P>



<PRE>
  # file $ENV{HOME}/.apache-test/Apache/TestConfigData.pm
  package Apache::TestConfigData;
  use strict;
  use warnings;
  use vars qw($vars);

  $vars = {
      'group' =&gt; 'me',
      'user' =&gt; 'myself',
      'port' =&gt; '8529',
      'httpd' =&gt; '/usr/local/apache/bin/httpd',

  };
  1;

</PRE>


<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">NAME</A><DD>
<DT><A HREF="#lbAC">SYNOPSIS</A><DD>
<DT><A HREF="#lbAD">DESCRIPTION</A><DD>
<DT><A HREF="#lbAE">METHODS</A><DD>
<DL>
<DT><A HREF="#lbAF">bug_report</A><DD>
<DT><A HREF="#lbAG">pre_configure</A><DD>
<DT><A HREF="#lbAH">new_test_config</A><DD>
</DL>
<DT><A HREF="#lbAI">Persistent Custom Configuration</A><DD>
<DL>
<DT><A HREF="#lbAJ">Saving Custom Configuration Options</A><DD>
</DL>
</DL>
<HR>
This document was created by
<A HREF="/man/index.html">man2html</A>,
using the manual pages.<BR>
Time: 05:33:11 GMT, December 24, 2015
</div></body>
</HTML>
