<!DOCTYPE html>

<HTML><head><TITLE>Manpage of FLOCK</TITLE>
<meta charset="utf-8">
<link rel="stylesheet" href="/css/main.css" type="text/css">
</head>
<body>
 <header class="site-header">
 <div class="wrap"> <div class="site-title"><a href="/man/index.html">linux man pages</a></div>
 <div class="site-description">{"type":"programming"}</div>
 </div>
 </header>
 <div class="page-content">
<H1>FLOCK</H1>
Section: H. Peter Anvin (1)<BR>Updated: 4 Feb 2006<BR><A HREF="#index">Index</A>
<A HREF="/man/index.html">Return to Main Contents</A><HR>

<A NAME="lbAB">&nbsp;</A>
<H2>NAME</H2>

flock - Manage locks from shell scripts
<A NAME="lbAC">&nbsp;</A>
<H2>SYNOPSIS</H2>

<B>flock</B> [<B>-sxon</B>] [<B>-w</B> <I>timeout</I>] <I>lockfile</I> [<B>-c</B>] <I>command...</I>
<P>

<B>flock</B> [<B>-sxon</B>] [<B>-w</B> <I>timeout</I>] <I>lockdir</I> [<B>-c</B>] <I>command...</I>
<P>

<B>flock</B> [<B>-sxun</B>] [<B>-w</B> <I>timeout</I>] <I>fd</I>
<A NAME="lbAD">&nbsp;</A>
<H2>DESCRIPTION</H2>

<P>

This utility manages
<B><A HREF="/man/index.html?2+flock">flock</A></B>(2)

locks from within shell scripts or the command line.
<P>

The first and second forms wraps the lock around the executing a command, in a manner similar to
<B><A HREF="/man/index.html?1+su">su</A></B>(1)

or
<B><A HREF="/man/index.html?1+newgrp">newgrp</A></B>(1).

It locks a specified file or directory, which is created (assuming appropriate
permissions), if it does not already exist.
<P>

The third form is convenient inside shell scripts, and is usually
used the following manner:
<P>

(
<BR>

<BR>&nbsp;&nbsp;flock&nbsp;-s&nbsp;200
<BR>

<BR>&nbsp;&nbsp;#&nbsp;...&nbsp;commands&nbsp;executed&nbsp;under&nbsp;lock&nbsp;...
<BR>

) 200&gt;/var/lock/mylockfile
<P>

The mode used to open the file doesn't matter to <B>flock</B>; using
&gt; or &gt;&gt; allows the lockfile to be created if it does not
already exist, however, write permission is required; using &lt;
requires that the file already exists but only read permission is
required.
<P>

By default, if the lock cannot be immediately acquired, <B>flock</B>
waits until the lock is available.
<A NAME="lbAE">&nbsp;</A>
<H2>OPTIONS</H2>

<DL COMPACT>
<DT><B>-s</B>, <B>--shared</B><DD>
Obtain a shared lock, sometimes called a read lock.
<DT><B>-x</B>, <B>-e</B>, <B>--exclusive</B><DD>
Obtain an exclusive lock, sometimes called a write lock.  This is the
default.
<DT><B>-u</B>, <B>--unlock</B><DD>
Drop a lock.  This is usually not required, since a lock is
automatically dropped when the file is closed.  However, it may be
required in special cases, for example if the enclosed command group
may have forked a background process which should not be holding the
lock.
<DT><B>-n</B>, <B>--nb</B>, <B>--nonblock</B><DD>
Fail (with an exit code of 1) rather than wait if the lock cannot be
immediately acquired.
<DT><B>-w</B>, <B>--wait</B>, <B>--timeout</B> <I>seconds</I><DD>
Fail (with an exit code of 1) if the lock cannot be acquired within
<I>seconds</I> seconds.  Decimal fractional values are allowed.
<DT><B>-o</B>, <B>--close</B><DD>
Close the file descriptor on which the lock is held before executing
<I>command</I>.  This is useful if <I>command</I> spawns a child process
which should not be hold ing the lock.
<DT><B>-c</B>, <B>--command</B> <I>command</I><DD>
Pass a single <I>command</I> to the shell with <B>-c</B>.
<DT><B>-h</B>, <B>--help</B><DD>
Print a help message.
</DL>
<A NAME="lbAF">&nbsp;</A>
<H2>AUTHOR</H2>

Written by H. Peter Anvin &lt;<A HREF="mailto:hpa@zytor.com">hpa@zytor.com</A>&gt;.
<A NAME="lbAG">&nbsp;</A>
<H2>COPYRIGHT</H2>

Copyright &#169; 2003-2006 H. Peter Anvin.
<BR>

This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
<A NAME="lbAH">&nbsp;</A>
<H2>SEE ALSO</H2>

<B><A HREF="/man/index.html?2+flock">flock</A></B>(2)

<A NAME="lbAI">&nbsp;</A>
<H2>AVAILABILITY</H2>

The flock command is part of the util-linux-ng package and is available from
<A HREF="ftp://ftp.kernel.org/pub/linux/utils/util-linux-ng/.">ftp://ftp.kernel.org/pub/linux/utils/util-linux-ng/.</A>
<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">NAME</A><DD>
<DT><A HREF="#lbAC">SYNOPSIS</A><DD>
<DT><A HREF="#lbAD">DESCRIPTION</A><DD>
<DT><A HREF="#lbAE">OPTIONS</A><DD>
<DT><A HREF="#lbAF">AUTHOR</A><DD>
<DT><A HREF="#lbAG">COPYRIGHT</A><DD>
<DT><A HREF="#lbAH">SEE ALSO</A><DD>
<DT><A HREF="#lbAI">AVAILABILITY</A><DD>
</DL>
<HR>
This document was created by
<A HREF="/man/index.html">man2html</A>,
using the manual pages.<BR>
Time: 05:29:03 GMT, December 24, 2015
</div></body>
</HTML>
